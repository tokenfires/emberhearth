<mxfile host="app.diagrams.net" modified="2026-02-03T00:00:00.000Z" agent="EmberHearth Architecture" version="22.0.0" type="device">
  <diagram name="System Overview" id="system-overview">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- LEGEND -->
        <mxCell id="legend-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="200" height="120" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="&lt;b&gt;LEGEND&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="80" y="25" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-mvp" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="30" y="50" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-mvp-text" value="MVP (Phase 2-3)" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="50" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-full" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="30" y="75" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-full-text" value="Full System" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="75" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-ext" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="30" y="100" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-ext-text" value="External" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="100" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-future" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="130" y="50" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-future-text" value="Future" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="155" y="50" width="60" height="20" as="geometry" />
        </mxCell>

        <!-- TITLE -->
        <mxCell id="title" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;&lt;b&gt;EmberHearth System Architecture&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="400" height="40" as="geometry" />
        </mxCell>

        <!-- USER TOUCHPOINTS SECTION -->
        <mxCell id="user-section" value="&lt;b&gt;USER TOUCHPOINTS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="80" width="960" height="140" as="geometry" />
        </mxCell>

        <!-- iMessage - MVP -->
        <mxCell id="imessage" value="&lt;b&gt;iMessage&lt;/b&gt;&lt;br&gt;(Primary Interface)&lt;br&gt;&lt;br&gt;Personal: +1-555-XXX&lt;br&gt;Work: +1-555-YYY" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="115" width="160" height="90" as="geometry" />
        </mxCell>

        <!-- MacOS App - MVP -->
        <mxCell id="macos-app" value="&lt;b&gt;MacOS App&lt;/b&gt;&lt;br&gt;(Admin Interface)&lt;br&gt;&lt;br&gt;Onboarding, Settings&lt;br&gt;Data Browser" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="450" y="115" width="160" height="90" as="geometry" />
        </mxCell>

        <!-- Group Chat - Full -->
        <mxCell id="group-chat" value="&lt;b&gt;Group Chat&lt;/b&gt;&lt;br&gt;(Social Mode)&lt;br&gt;&lt;br&gt;No tools/memory&lt;br&gt;Natural timing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="640" y="115" width="160" height="90" as="geometry" />
        </mxCell>

        <!-- Web UI - Future -->
        <mxCell id="web-ui" value="&lt;b&gt;Web UI&lt;/b&gt;&lt;br&gt;(Future)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="830" y="115" width="110" height="90" as="geometry" />
        </mxCell>

        <!-- Voice - Future -->
        <mxCell id="voice" value="&lt;b&gt;Voice&lt;/b&gt;&lt;br&gt;(Future)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="970" y="115" width="110" height="90" as="geometry" />
        </mxCell>

        <!-- DEFENSE LAYERS SECTION -->
        <mxCell id="defense-section" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="240" y="240" width="960" height="100" as="geometry" />
        </mxCell>
        <mxCell id="input-gateway" value="&lt;b&gt;Input Gateway&lt;/b&gt;&lt;br&gt;Rate limit, Validate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="255" width="150" height="70" as="geometry" />
        </mxCell>
        <mxCell id="tron" value="&lt;b&gt;TRON&lt;/b&gt;&lt;br&gt;Prompt injection | Tool auth | Anomaly" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="255" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="output-validation" value="&lt;b&gt;Output Validation&lt;/b&gt;&lt;br&gt;Secret detect, PII redact" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="670" y="255" width="170" height="70" as="geometry" />
        </mxCell>
        <mxCell id="workbench" value="&lt;b&gt;Workbench&lt;/b&gt;&lt;br&gt;Isolated container" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="860" y="255" width="140" height="70" as="geometry" />
        </mxCell>
        <mxCell id="defense-note" value="See: Security Layers drill-down" style="text;html=1;strokeColor=none;fillColor=none;fontStyle=2;fontSize=9;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1010" y="290" width="140" height="20" as="geometry" />
        </mxCell>

        <!-- CORE SECTION -->
        <mxCell id="core-section" value="&lt;b&gt;EMBERHEARTH CORE&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="360" width="960" height="310" as="geometry" />
        </mxCell>

        <!-- Main App - MVP -->
        <mxCell id="main-app" value="&lt;b&gt;EmberHearth.app&lt;/b&gt;&lt;br&gt;(Main Process)&lt;br&gt;&lt;hr&gt;SwiftUI UI&lt;br&gt;XPC Coordinator&lt;br&gt;Permission Manager" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="520" y="390" width="180" height="110" as="geometry" />
        </mxCell>

        <!-- XPC Services with Sandbox Boundary -->
        <mxCell id="sandbox-boundary" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#B85450;strokeWidth=2;dashed=1;dashPattern=8 4;" vertex="1" parent="1">
          <mxGeometry x="255" y="515" width="750" height="150" as="geometry" />
        </mxCell>
        <mxCell id="sandbox-label" value="&lt;b&gt;APP SANDBOX BOUNDARY&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontStyle=0;align=left;fontColor=#B85450;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="265" y="518" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="xpc-label" value="XPC Services (Isolated Processes)" style="text;html=1;strokeColor=none;fillColor=none;fontStyle=1;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="530" y="515" width="200" height="20" as="geometry" />
        </mxCell>

        <!-- MessageService - MVP -->
        <mxCell id="msg-service" value="&lt;b&gt;MessageService.xpc&lt;/b&gt;&lt;hr&gt;MessageReader (SQLite)&lt;br&gt;MessageSender (AppleScript)&lt;br&gt;MessageRouter&lt;br&gt;GroupChatDetector" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="270" y="540" width="200" height="110" as="geometry" />
        </mxCell>

        <!-- MemoryService - Mixed -->
        <mxCell id="mem-service" value="&lt;b&gt;MemoryService.xpc&lt;/b&gt;&lt;hr&gt;MemoryDatabase&lt;br&gt;ConversationArchive&lt;br&gt;SessionState&lt;br&gt;Summarizer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="510" y="540" width="200" height="110" as="geometry" />
        </mxCell>
        <mxCell id="mem-service-full" value="Embeddings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="625" width="90" height="25" as="geometry" />
        </mxCell>

        <!-- LLMService - Mixed -->
        <mxCell id="llm-service" value="&lt;b&gt;LLMService.xpc&lt;/b&gt;&lt;hr&gt;CloudProvider&lt;br&gt;ContextBuilder&lt;br&gt;PolicyEnforcer&lt;br&gt;&lt;b&gt;AdaptiveRouter&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="750" y="540" width="200" height="110" as="geometry" />
        </mxCell>
        <mxCell id="llm-local" value="LocalProvider (MLX)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="760" y="625" width="130" height="25" as="geometry" />
        </mxCell>
        <mxCell id="llm-note" value="See: LLM Orchestration drill-down" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="760" y="650" width="160" height="15" as="geometry" />
        </mxCell>

        <!-- Ember Personality -->
        <mxCell id="ember" value="&lt;b&gt;EMBER&lt;/b&gt;&lt;br&gt;(Personality)&lt;hr&gt;System Prompt&lt;br&gt;Voice &amp; Tone&lt;br&gt;Emotional Encoding" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="390" width="160" height="110" as="geometry" />
        </mxCell>

        <!-- Plugin System - Future -->
        <mxCell id="plugin-system" value="&lt;b&gt;Plugin System&lt;/b&gt;&lt;hr&gt;Plugin Manager&lt;br&gt;JS Runtime (Sandbox)&lt;br&gt;EmberHearth API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="530" width="160" height="105" as="geometry" />
        </mxCell>
        <mxCell id="plugin-note" value="See: Plugin drill-down" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="635" width="120" height="15" as="geometry" />
        </mxCell>

        <!-- XPC Connections -->
        <mxCell id="xpc1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;endArrow=none;endFill=0;" edge="1" parent="1" source="main-app" target="msg-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xpc2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;endArrow=none;endFill=0;" edge="1" parent="1" source="main-app" target="mem-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xpc3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;endArrow=none;endFill=0;" edge="1" parent="1" source="main-app" target="llm-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- EXTERNAL SECTION -->
        <mxCell id="ext-section" value="&lt;b&gt;EXTERNAL DEPENDENCIES&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="690" width="960" height="190" as="geometry" />
        </mxCell>

        <!-- iMessage Backend -->
        <mxCell id="chat-db" value="&lt;b&gt;iMessage&lt;/b&gt;&lt;hr&gt;~/Library/Messages/chat.db&lt;br&gt;Messages.app (AppleScript)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="725" width="200" height="90" as="geometry" />
        </mxCell>

        <!-- Data Stores -->
        <mxCell id="data-stores" value="&lt;b&gt;Data Stores&lt;/b&gt;&lt;hr&gt;personal/memory.db&lt;br&gt;personal/archive.db&lt;br&gt;work/memory.db&lt;br&gt;work/audit.log" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="725" width="170" height="110" as="geometry" />
        </mxCell>
        <mxCell id="data-path" value="~/Library/Application Support/EmberHearth/" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="840" width="200" height="15" as="geometry" />
        </mxCell>

        <!-- LLM APIs -->
        <mxCell id="llm-apis" value="&lt;b&gt;LLM APIs&lt;/b&gt;&lt;hr&gt;Claude (Anthropic) ✓&lt;br&gt;OpenAI&lt;br&gt;Local (MLX)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="690" y="725" width="150" height="90" as="geometry" />
        </mxCell>

        <!-- Apple Frameworks + Integration Services -->
        <mxCell id="apple-fw" value="&lt;b&gt;Apple Frameworks&lt;/b&gt;&lt;hr&gt;EventKit (Calendar)&lt;br&gt;Contacts&lt;br&gt;MapKit, HomeKit..." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="870" y="725" width="170" height="90" as="geometry" />
        </mxCell>
        <mxCell id="integration-services" value="&lt;b&gt;Integration XPCs&lt;/b&gt;&lt;br&gt;CalendarService, MailService, NotesService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="870" y="820" width="170" height="50" as="geometry" />
        </mxCell>
        <mxCell id="int-note" value="See: Integrations drill-down" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="870" y="870" width="150" height="15" as="geometry" />
        </mxCell>

        <!-- Security -->
        <mxCell id="security" value="&lt;b&gt;Security&lt;/b&gt;&lt;hr&gt;Keychain (API keys)&lt;br&gt;Secure Enclave (DB keys)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1060" y="725" width="170" height="90" as="geometry" />
        </mxCell>

        <!-- Ember to LLM Connection -->
        <mxCell id="ember-llm" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9673a6;strokeWidth=2;endArrow=classic;endFill=1;dashed=1;" edge="1" parent="1" source="ember" target="llm-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ember-label" value="System prompt" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="960" y="510" width="80" height="15" as="geometry" />
        </mxCell>

        <!-- Connections -->
        <mxCell id="conn1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="imessage" target="input-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="output-validation" target="main-app">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=1;endArrow=classic;endFill=1;" edge="1" parent="1" source="msg-service" target="chat-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=1;endArrow=classic;endFill=1;" edge="1" parent="1" source="mem-service" target="data-stores">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=1;endArrow=classic;endFill=1;" edge="1" parent="1" source="llm-service" target="llm-apis">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Data Flow - Message Processing" id="data-flow">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="df-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Data Flow: Incoming Message Processing&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="400" height="30" as="geometry" />
        </mxCell>

        <!-- Step 1: iMessage -->
        <mxCell id="df-step1" value="&lt;b&gt;1. New Message&lt;/b&gt;&lt;br&gt;&lt;br&gt;FSEvents detects&lt;br&gt;change in chat.db" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Step 2: MessageService -->
        <mxCell id="df-step2" value="&lt;b&gt;2. MessageService&lt;/b&gt;&lt;br&gt;&lt;br&gt;Read message&lt;br&gt;Detect context&lt;br&gt;Check if group" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Step 3: Tron -->
        <mxCell id="df-step3" value="&lt;b&gt;3. Tron&lt;/b&gt;&lt;br&gt;&lt;br&gt;Security check&lt;br&gt;Group? → Social only&lt;br&gt;Authorize tools" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="360" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Step 4: MemoryService -->
        <mxCell id="df-step4" value="&lt;b&gt;4. MemoryService&lt;/b&gt;&lt;br&gt;&lt;br&gt;Retrieve session&lt;br&gt;Get memories&lt;br&gt;Get archive chunks" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="520" y="100" width="130" height="80" as="geometry" />
        </mxCell>

        <!-- Step 5: Context Builder -->
        <mxCell id="df-step5" value="&lt;b&gt;5. Build Context&lt;/b&gt;&lt;br&gt;&lt;br&gt;10% system prompt&lt;br&gt;25% recent msgs&lt;br&gt;15% memories&lt;br&gt;10% summary" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="690" y="100" width="130" height="80" as="geometry" />
        </mxCell>

        <!-- Step 6: LLM -->
        <mxCell id="df-step6" value="&lt;b&gt;6. LLMService&lt;/b&gt;&lt;br&gt;&lt;br&gt;Send to Claude API&lt;br&gt;Stream response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="860" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Step 7: External LLM -->
        <mxCell id="df-step7" value="&lt;b&gt;7. LLM API&lt;/b&gt;&lt;br&gt;&lt;br&gt;Process request&lt;br&gt;Generate response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Return flow -->
        <mxCell id="df-step8" value="&lt;b&gt;8. Send Response&lt;/b&gt;&lt;br&gt;&lt;br&gt;AppleScript to&lt;br&gt;Messages.app" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="250" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Async memory extraction -->
        <mxCell id="df-step9" value="&lt;b&gt;9. Async: Memory&lt;/b&gt;&lt;br&gt;&lt;br&gt;Extract facts&lt;br&gt;Update archive&lt;br&gt;Update session" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="520" y="250" width="130" height="80" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <mxCell id="df-a1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step1" target="df-step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step2" target="df-step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step3" target="df-step4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step4" target="df-step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step5" target="df-step6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step6" target="df-step7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;dashed=1;" edge="1" parent="1" source="df-step7" target="df-step8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1080" y="210" />
              <mxPoint x="260" y="210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="df-a8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#6c8ebf;strokeWidth=2;endArrow=classic;dashed=1;" edge="1" parent="1" source="df-step6" target="df-step9">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="920" y="200" />
              <mxPoint x="720" y="200" />
              <mxPoint x="720" y="290" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Notes -->
        <mxCell id="df-note1" value="Solid = sync&lt;br&gt;Dashed = async/return" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="350" width="120" height="30" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="MVP Scope" id="mvp-scope">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="600" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="mvp-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;MVP Scope (Phase 2-3)&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="300" height="30" as="geometry" />
        </mxCell>

        <!-- MVP Box -->
        <mxCell id="mvp-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=3;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="400" height="480" as="geometry" />
        </mxCell>
        <mxCell id="mvp-label" value="&lt;b&gt;MVP SCOPE&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=14;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="100" height="25" as="geometry" />
        </mxCell>

        <!-- MVP Items -->
        <mxCell id="mvp-1" value="&lt;b&gt;EmberHearth.app&lt;/b&gt;&lt;br&gt;Basic SwiftUI shell" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="120" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-2" value="&lt;b&gt;Onboarding&lt;/b&gt;&lt;br&gt;Permissions, LLM setup" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="120" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-3" value="&lt;b&gt;MessageService&lt;/b&gt;&lt;br&gt;Read/write iMessage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="190" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-4" value="&lt;b&gt;Personal Context Only&lt;/b&gt;&lt;br&gt;Single phone number" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="190" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-5" value="&lt;b&gt;MemoryService&lt;/b&gt;&lt;br&gt;Basic fact storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="260" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-6" value="&lt;b&gt;Session State&lt;/b&gt;&lt;br&gt;Recent messages cache" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="260" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-7" value="&lt;b&gt;LLMService&lt;/b&gt;&lt;br&gt;Claude API only" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="330" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-8" value="&lt;b&gt;Context Building&lt;/b&gt;&lt;br&gt;Basic budget allocation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="330" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-9" value="&lt;b&gt;Tron (Hardcoded)&lt;/b&gt;&lt;br&gt;Basic rules only" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="400" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-10" value="&lt;b&gt;Group Chat&lt;/b&gt;&lt;br&gt;Detect and block" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="400" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-11" value="&lt;b&gt;Identity&lt;/b&gt;&lt;br&gt;Passkey confirmation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="150" y="470" width="160" height="50" as="geometry" />
        </mxCell>

        <!-- Later Box -->
        <mxCell id="later-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=3;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="480" y="70" width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="later-label" value="&lt;b&gt;FULL SYSTEM (Phase 4+)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=14;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="80" width="180" height="25" as="geometry" />
        </mxCell>

        <!-- Later Items -->
        <mxCell id="later-1" value="Work context" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="120" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-2" value="Embeddings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="120" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-3" value="Conv. Archive" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="165" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-4" value="Local models" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="165" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-5" value="Full Tron" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="210" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-6" value="Group social" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="210" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-7" value="Apple integrations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="255" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-8" value="Data browser" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="255" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-9" value="OpenAI provider" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="300" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-10" value="Audit logging" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="300" width="100" height="35" as="geometry" />
        </mxCell>

        <!-- Future Box -->
        <mxCell id="future-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=3;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="480" y="410" width="240" height="140" as="geometry" />
        </mxCell>
        <mxCell id="future-label" value="&lt;b&gt;FUTURE / EARMARKED&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=14;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="420" width="180" height="25" as="geometry" />
        </mxCell>

        <!-- Future Items -->
        <mxCell id="future-1" value="Multi-user roles" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="455" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="future-2" value="Family groups" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="455" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="future-3" value="Web UI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="500" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="future-4" value="Voice interface" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="500" width="100" height="35" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Plugin System" id="plugin-system-detail">
    <mxGraphModel dx="1100" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <mxCell id="ps-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Plugin System Architecture&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="300" height="30" as="geometry" />
        </mxCell>

        <mxCell id="ps-manager" value="&lt;b&gt;Plugin Manager&lt;/b&gt;&lt;hr&gt;Load manifests&lt;br&gt;Register tools with LLM&lt;br&gt;Route tool calls&lt;br&gt;Enforce permissions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="80" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Sandbox Boundary for Plugin Runtime -->
        <mxCell id="ps-sandbox-boundary" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#B85450;strokeWidth=2;dashed=1;dashPattern=8 4;" vertex="1" parent="1">
          <mxGeometry x="50" y="230" width="240" height="310" as="geometry" />
        </mxCell>
        <mxCell id="ps-sandbox-label" value="&lt;b&gt;JAVASCRIPTCORE SANDBOX&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontStyle=0;align=center;fontColor=#B85450;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="60" y="235" width="220" height="18" as="geometry" />
        </mxCell>
        <mxCell id="ps-runtime" value="&lt;b&gt;Plugin Runtime&lt;/b&gt;&lt;hr&gt;JavaScriptCore Engine&lt;br&gt;No filesystem access&lt;br&gt;Declared network only&lt;br&gt;Execution timeout" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="70" y="265" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ps-api" value="&lt;b&gt;EmberHearth API&lt;/b&gt;&lt;hr&gt;calendar.listEvents()&lt;br&gt;contacts.search()&lt;br&gt;memory.query()&lt;br&gt;notifications.send()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="250" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ps-registry" value="&lt;b&gt;Tool Registry&lt;/b&gt;&lt;hr&gt;Map plugin tools&lt;br&gt;to EmberHearth APIs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="730" y="250" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ps-moltbot" value="&lt;b&gt;Moltbot Compat&lt;/b&gt;&lt;hr&gt;Import AgentSkills&lt;br&gt;Security adaptation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="730" y="380" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ps-perms" value="&lt;b&gt;Permission System&lt;/b&gt;&lt;hr&gt;network: [domains]&lt;br&gt;secrets: [names]&lt;br&gt;storage: quota&lt;br&gt;apis: [allowed]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="70" y="405" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ps-manifest" value="&lt;b&gt;Plugin Manifest&lt;/b&gt;&lt;hr&gt;name, version&lt;br&gt;tools: [definitions]&lt;br&gt;permissions: [required]&lt;br&gt;entry: main.js" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="410" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ps-a1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="ps-manager" target="ps-runtime">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ps-a2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="ps-manager" target="ps-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ps-a3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="ps-manager" target="ps-registry">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="ps-note" value="Phase: Future (v2+)&lt;br&gt;MCP-style tool registration" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="50" y="570" width="180" height="30" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="LLM Orchestration" id="llm-orchestration">
    <mxGraphModel dx="1200" dy="850" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="850" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <mxCell id="llm-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;LLM Orchestration &amp;amp; Routing&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="20" width="340" height="30" as="geometry" />
        </mxCell>

        <mxCell id="llm-modes-box" value="&lt;b&gt;Four LLM Modes&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="600" height="140" as="geometry" />
        </mxCell>
        <mxCell id="llm-mode1" value="&lt;b&gt;Cloud Only&lt;/b&gt;&lt;br&gt;(Default/MVP)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="105" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="llm-mode2" value="&lt;b&gt;Local Only&lt;/b&gt;&lt;br&gt;(Privacy)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="105" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="llm-mode3" value="&lt;b&gt;Simple Hybrid&lt;/b&gt;&lt;br&gt;(Auto-route)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="340" y="105" width="130" height="80" as="geometry" />
        </mxCell>
        <mxCell id="llm-mode4" value="&lt;b&gt;Orchestrated&lt;/b&gt;&lt;br&gt;(Recommended)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="105" width="130" height="80" as="geometry" />
        </mxCell>

        <mxCell id="llm-router" value="&lt;b&gt;Adaptive Router&lt;/b&gt;&lt;hr&gt;Query complexity&lt;br&gt;Context policy&lt;br&gt;Performance history&lt;br&gt;Quality signals" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="680" y="85" width="180" height="120" as="geometry" />
        </mxCell>

        <mxCell id="llm-orch-box" value="&lt;b&gt;Orchestrated Hybrid Detail&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="240" width="820" height="230" as="geometry" />
        </mxCell>
        <mxCell id="llm-cloud-orch" value="&lt;b&gt;Cloud Orchestrator&lt;/b&gt;&lt;br&gt;(Claude/GPT-4)&lt;hr&gt;Understand intent&lt;br&gt;Plan subtasks&lt;br&gt;Synthesize response&lt;br&gt;Quality review" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="330" y="275" width="180" height="140" as="geometry" />
        </mxCell>
        <mxCell id="llm-local-cal" value="&lt;b&gt;Calendar Agent&lt;/b&gt;&lt;br&gt;(Local Qwen)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="70" y="380" width="130" height="65" as="geometry" />
        </mxCell>
        <mxCell id="llm-local-mail" value="&lt;b&gt;Email Agent&lt;/b&gt;&lt;br&gt;(Local Qwen)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="550" y="380" width="130" height="65" as="geometry" />
        </mxCell>
        <mxCell id="llm-local-draft" value="&lt;b&gt;Draft Agent&lt;/b&gt;&lt;br&gt;(Local Qwen)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="700" y="380" width="130" height="65" as="geometry" />
        </mxCell>

        <mxCell id="llm-self-tune" value="&lt;b&gt;Self-Tuning Engine&lt;/b&gt;&lt;hr&gt;Performance signals&lt;br&gt;Quality signals&lt;br&gt;Graceful degradation&lt;br&gt;User notifications" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="900" y="240" width="180" height="130" as="geometry" />
        </mxCell>

        <mxCell id="llm-monitor" value="&lt;b&gt;Monitoring Dashboard&lt;/b&gt;&lt;hr&gt;Token usage&lt;br&gt;Cost tracking&lt;br&gt;A/B testing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="900" y="390" width="180" height="110" as="geometry" />
        </mxCell>

        <mxCell id="llm-a1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="llm-cloud-orch" target="llm-local-cal">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="llm-a2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="llm-cloud-orch" target="llm-local-mail">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="llm-a3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="llm-cloud-orch" target="llm-local-draft">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-privacy-note" value="&lt;b&gt;Privacy:&lt;/b&gt; Sensitive data stays local.&lt;br&gt;Only structured summaries go to cloud." style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="500" width="250" height="50" as="geometry" />
        </mxCell>

        <!-- RALPH LOOP SECTION -->
        <mxCell id="llm-ralph-section" value="&lt;b&gt;RALPH LOOP - Iterative Quality Cycles&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="570" width="500" height="200" as="geometry" />
        </mxCell>

        <mxCell id="llm-ralph-spec" value="&lt;b&gt;1. Spec&lt;/b&gt;&lt;hr&gt;Clear requirements&lt;br&gt;Expected output&lt;br&gt;Quality criteria" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="610" width="100" height="90" as="geometry" />
        </mxCell>

        <mxCell id="llm-ralph-action" value="&lt;b&gt;2. Action&lt;/b&gt;&lt;hr&gt;Execute task&lt;br&gt;Fresh context&lt;br&gt;No pollution" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="175" y="610" width="100" height="90" as="geometry" />
        </mxCell>

        <mxCell id="llm-ralph-review" value="&lt;b&gt;3. Review&lt;/b&gt;&lt;hr&gt;Self-check prompts&lt;br&gt;Structured eval&lt;br&gt;Quality score" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="290" y="610" width="100" height="90" as="geometry" />
        </mxCell>

        <mxCell id="llm-ralph-iterate" value="&lt;b&gt;4. Iterate&lt;/b&gt;&lt;hr&gt;Fix issues&lt;br&gt;Re-review&lt;br&gt;Until threshold" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="405" y="610" width="100" height="90" as="geometry" />
        </mxCell>

        <!-- Ralph Loop arrows -->
        <mxCell id="llm-ralph-a1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="llm-ralph-spec" target="llm-ralph-action">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="llm-ralph-a2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="llm-ralph-action" target="llm-ralph-review">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="llm-ralph-a3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="llm-ralph-review" target="llm-ralph-iterate">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <!-- Iterate loop back -->
        <mxCell id="llm-ralph-loop" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="455" y="710" as="sourcePoint" />
            <mxPoint x="225" y="710" as="targetPoint" />
            <Array as="points">
              <mxPoint x="455" y="730" />
              <mxPoint x="225" y="730" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="llm-ralph-loop-label" value="if quality &lt; threshold" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="290" y="732" width="120" height="15" as="geometry" />
        </mxCell>

        <mxCell id="llm-ralph-note" value="&lt;b&gt;Key Insight:&lt;/b&gt; Local models (MLX) use Ralph Loop to match cloud quality.&lt;br&gt;Ember (foundation model) judges when enough is enough." style="text;html=1;strokeColor=#9673a6;fillColor=#E1D5E7;fontSize=9;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="560" y="610" width="220" height="50" as="geometry" />
        </mxCell>

        <mxCell id="llm-ralph-ref" value="See: docs/research/iterative-quality-loops.md" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="560" y="670" width="220" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Security Layers" id="security-layers">
    <mxGraphModel dx="1100" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <mxCell id="sec-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Defense in Depth - Security Layers&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="400" height="30" as="geometry" />
        </mxCell>

        <mxCell id="sec-l1" value="&lt;b&gt;Layer 1: Input Gateway&lt;/b&gt;&lt;hr&gt;Rate limiting&lt;br&gt;Format validation&lt;br&gt;Known attack patterns" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l2" value="&lt;b&gt;Layer 2: Tron Firewall&lt;/b&gt;&lt;hr&gt;Signature-based detection&lt;br&gt;ML classification&lt;br&gt;Structural analysis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="270" y="80" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l3" value="&lt;b&gt;Layer 3: Capability Bounds&lt;/b&gt;&lt;hr&gt;Structured ops only&lt;br&gt;Sandboxed file access&lt;br&gt;Credential use not expose" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="80" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l4" value="&lt;b&gt;Layer 4: Workbench&lt;/b&gt;&lt;hr&gt;Docker/gVisor container&lt;br&gt;No ambient authority&lt;br&gt;Explicit data transfer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="730" y="80" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l5" value="&lt;b&gt;Layer 5: Output Validation&lt;/b&gt;&lt;hr&gt;Secret detection&lt;br&gt;PII redaction&lt;br&gt;Behavior anomaly" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="270" y="220" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l6" value="&lt;b&gt;Layer 6: Retrospective&lt;/b&gt;&lt;hr&gt;Continuous history scan&lt;br&gt;Incident correlation&lt;br&gt;Signature feedback" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="220" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-tron-detail" value="&lt;b&gt;Tron Responsibilities&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="370" width="470" height="180" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-1" value="Prompt injection firewall" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="410" width="180" height="45" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-2" value="Tool call authorization" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="410" width="180" height="45" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-3" value="Group chat restrictions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="470" width="180" height="45" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-4" value="Anomaly detection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="470" width="180" height="45" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-5" value="Audit logging" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="160" y="525" width="180" height="40" as="geometry" />
        </mxCell>

        <mxCell id="sec-keychain" value="&lt;b&gt;Keychain Integration&lt;/b&gt;&lt;hr&gt;API keys per context&lt;br&gt;Secure Enclave for DB keys&lt;br&gt;Credentials used not exposed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="540" y="370" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="sec-sandbox" value="&lt;b&gt;App Sandbox&lt;/b&gt;&lt;hr&gt;Container isolation&lt;br&gt;Entitlements&lt;br&gt;Hardened Runtime" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="770" y="370" width="180" height="120" as="geometry" />
        </mxCell>

        <mxCell id="sec-mvp-note" value="MVP: Layers 1, 3 only (hardcoded rules)" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="580" width="220" height="20" as="geometry" />
        </mxCell>

        <!-- TRON PIPELINES (NEW) -->
        <mxCell id="sec-pipe-section" value="&lt;b&gt;TRON SECURITY PIPELINES&lt;/b&gt;  (Full spec: docs/specs/tron-security.md)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="620" width="910" height="160" as="geometry" />
        </mxCell>

        <mxCell id="sec-inbound" value="&lt;b&gt;Inbound Pipeline&lt;/b&gt;&lt;hr&gt;• Prompt injection defense&lt;br&gt;• Signature detection&lt;br&gt;• Heuristic analysis&lt;br&gt;• Spotlighting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="660" width="140" height="100" as="geometry" />
        </mxCell>

        <mxCell id="sec-cred" value="&lt;b&gt;Credential Detection&lt;/b&gt;&lt;hr&gt;• 20+ patterns&lt;br&gt;• API keys, tokens&lt;br&gt;• SSH keys, certs&lt;br&gt;• Database strings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="215" y="660" width="140" height="100" as="geometry" />
        </mxCell>

        <mxCell id="sec-pii" value="&lt;b&gt;PII Scanning&lt;/b&gt;&lt;hr&gt;• SSN, credit cards&lt;br&gt;• Medical IDs&lt;br&gt;• Bank accounts&lt;br&gt;• Passports" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="370" y="660" width="130" height="100" as="geometry" />
        </mxCell>

        <mxCell id="sec-outbound" value="&lt;b&gt;Outbound Pipeline&lt;/b&gt;&lt;hr&gt;• Leak prevention&lt;br&gt;• Behavior anomaly&lt;br&gt;• Response validation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="515" y="660" width="130" height="100" as="geometry" />
        </mxCell>

        <mxCell id="sec-override" value="&lt;b&gt;Tiered User Override&lt;/b&gt;&lt;hr&gt;🟢 Auto-allow&lt;br&gt;🟡 Confirm&lt;br&gt;🔴 Block" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="660" y="660" width="120" height="100" as="geometry" />
        </mxCell>

        <mxCell id="sec-audit" value="&lt;b&gt;Audit Logging&lt;/b&gt;&lt;hr&gt;• Tamper-evident&lt;br&gt;• Event recording&lt;br&gt;• Forensic trail" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="795" y="660" width="130" height="100" as="geometry" />
        </mxCell>

        <!-- Flow Arrows: Data Pipeline -->
        <mxCell id="sec-flow-input" value="&lt;b&gt;Input&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#82b366;align=right;" vertex="1" parent="1">
          <mxGeometry x="-20" y="125" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="30" y="135" as="sourcePoint" />
            <mxPoint x="40" y="135" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sec-arr-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l1" target="sec-l2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l2" target="sec-l3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l3" target="sec-l4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l4" target="sec-l5">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="960" y="135" />
              <mxPoint x="960" y="275" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sec-arr-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l5" target="sec-l6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-out" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="700" y="275" as="sourcePoint" />
            <mxPoint x="1000" y="275" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sec-flow-output" value="&lt;b&gt;Output&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="1005" y="265" width="50" height="20" as="geometry" />
        </mxCell>
        <!-- Retrospective feedback loop -->
        <mxCell id="sec-arr-retro" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#6c8ebf;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1" source="sec-l6" target="sec-l2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="600" y="350" />
              <mxPoint x="370" y="350" />
              <mxPoint x="370" y="200" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sec-retro-label" value="Signature feedback" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="400" y="340" width="120" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Integration Services" id="integration-services">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <mxCell id="int-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Apple Integration Services&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="450" y="20" width="300" height="30" as="geometry" />
        </mxCell>

        <mxCell id="int-tier1" value="&lt;b&gt;Tier 1: Core Integrations&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;opacity=50;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="540" height="160" as="geometry" />
        </mxCell>
        <mxCell id="int-calendar" value="&lt;b&gt;CalendarService.xpc&lt;/b&gt;&lt;hr&gt;EventKit&lt;br&gt;List/Create events&lt;br&gt;Reminders" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="110" width="155" height="100" as="geometry" />
        </mxCell>
        <mxCell id="int-mail" value="&lt;b&gt;MailService.xpc&lt;/b&gt;&lt;hr&gt;Mail.app AppleScript&lt;br&gt;List/Send" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="235" y="110" width="155" height="100" as="geometry" />
        </mxCell>
        <mxCell id="int-contacts" value="&lt;b&gt;ContactsService.xpc&lt;/b&gt;&lt;hr&gt;Contacts framework&lt;br&gt;Search/Lookup" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="410" y="110" width="155" height="100" as="geometry" />
        </mxCell>

        <mxCell id="int-tier2" value="&lt;b&gt;Tier 2: Enhanced Integrations&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;opacity=50;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="260" width="700" height="160" as="geometry" />
        </mxCell>
        <mxCell id="int-notes" value="&lt;b&gt;NotesService&lt;/b&gt;&lt;hr&gt;Notes AppleScript" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="300" width="125" height="90" as="geometry" />
        </mxCell>
        <mxCell id="int-weather" value="&lt;b&gt;WeatherService&lt;/b&gt;&lt;hr&gt;WeatherKit" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="300" width="125" height="90" as="geometry" />
        </mxCell>
        <mxCell id="int-maps" value="&lt;b&gt;MapsService&lt;/b&gt;&lt;hr&gt;MapKit" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="340" y="300" width="125" height="90" as="geometry" />
        </mxCell>
        <mxCell id="int-homekit" value="&lt;b&gt;HomeService&lt;/b&gt;&lt;hr&gt;HomeKit" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="480" y="300" width="125" height="90" as="geometry" />
        </mxCell>
        <mxCell id="int-shortcuts" value="&lt;b&gt;ShortcutsService&lt;/b&gt;&lt;hr&gt;Shortcuts API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="620" y="300" width="105" height="90" as="geometry" />
        </mxCell>

        <mxCell id="int-protocol" value="&lt;b&gt;ContextAwareIntegration Protocol&lt;/b&gt;&lt;hr&gt;All services implement:&lt;br&gt;- detectContext() → .personal | .work&lt;br&gt;- routeToContext(context)&lt;br&gt;- getAccountsForContext(context)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="790" y="100" width="250" height="130" as="geometry" />
        </mxCell>

        <mxCell id="int-intent" value="&lt;b&gt;IntentRouter&lt;/b&gt;&lt;hr&gt;Classify user intent&lt;br&gt;Route to service&lt;br&gt;Enforce capability bounds" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="790" y="270" width="250" height="110" as="geometry" />
        </mxCell>

        <mxCell id="int-phases" value="&lt;b&gt;Implementation Phases&lt;/b&gt;&lt;br&gt;&lt;br&gt;MVP: No integrations&lt;br&gt;Phase 4: Tier 1 (Calendar, Mail, Contacts)&lt;br&gt;Phase 5+: Tier 2 (Notes, Weather, Maps, etc.)" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="450" width="280" height="100" as="geometry" />
        </mxCell>

        <!-- Flow: User Intent → IntentRouter → Services -->
        <mxCell id="int-input" value="&lt;b&gt;User Intent&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#82b366;align=right;" vertex="1" parent="1">
          <mxGeometry x="690" y="305" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="int-arr-in" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="775" y="325" as="sourcePoint" />
            <mxPoint x="790" y="325" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- IntentRouter to Tier 1 services -->
        <mxCell id="int-arr-cal" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="int-intent" target="int-calendar">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="760" y="380" />
              <mxPoint x="760" y="160" />
              <mxPoint x="580" y="160" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="int-arr-mail" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="int-intent" target="int-mail">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="740" y="380" />
              <mxPoint x="740" y="55" />
              <mxPoint x="313" y="55" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="int-arr-contacts" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="int-intent" target="int-contacts">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="720" y="380" />
              <mxPoint x="720" y="50" />
              <mxPoint x="138" y="50" />
              <mxPoint x="138" y="160" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- IntentRouter to Tier 2 services -->
        <mxCell id="int-arr-tier2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#6c8ebf;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1" source="int-intent" target="int-notes">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="790" y="410" />
              <mxPoint x="30" y="410" />
              <mxPoint x="30" y="345" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Protocol implements arrows -->
        <mxCell id="int-proto-arr1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=1;endArrow=block;endFill=0;dashed=1;dashPattern=4 2;" edge="1" parent="1" source="int-calendar" target="int-protocol">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="int-proto-label" value="implements" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="640" y="130" width="70" height="15" as="geometry" />
        </mxCell>

        <!-- Output arrow -->
        <mxCell id="int-arr-out" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1040" y="325" as="sourcePoint" />
            <mxPoint x="1100" y="325" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="int-output" value="&lt;b&gt;Response&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="1105" y="315" width="70" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Ember Personality System" id="ember-personality">
    <mxGraphModel dx="1200" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1500" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="pers-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Ember Personality System&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="600" y="20" width="280" height="30" as="geometry" />
        </mxCell>

        <!-- THREE-LAYER MODEL SECTION -->
        <mxCell id="pers-layers-section" value="&lt;b&gt;THREE-LAYER PERSONALITY MODEL&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="580" height="250" as="geometry" />
        </mxCell>

        <!-- Layer 1: Identity -->
        <mxCell id="pers-identity" value="&lt;b&gt;Layer 1: Identity&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Sex:&lt;/b&gt; Male | Female&lt;br&gt;&lt;b&gt;Name:&lt;/b&gt; Default &quot;Ember&quot;&lt;br&gt;&lt;br&gt;&lt;i&gt;Static - Set during onboarding&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="105" width="160" height="110" as="geometry" />
        </mxCell>

        <!-- Layer 2: Communication Style -->
        <mxCell id="pers-style" value="&lt;b&gt;Layer 2: Communication Style&lt;/b&gt;&lt;hr&gt;• Warmth (cool ↔ warm)&lt;br&gt;• Formality (casual ↔ formal)&lt;br&gt;• Verbosity (brief ↔ detailed)&lt;br&gt;• Humor (serious ↔ playful)&lt;br&gt;&lt;br&gt;&lt;i&gt;Configurable, adaptive&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="235" y="105" width="175" height="140" as="geometry" />
        </mxCell>

        <!-- Layer 3: Archetype -->
        <mxCell id="pers-archetype" value="&lt;b&gt;Layer 3: Archetype&lt;/b&gt;&lt;hr&gt;• Ember (warm, nurturing)&lt;br&gt;• Ash (professional, clear)&lt;br&gt;• Flint (mentor-like)&lt;br&gt;• Cinder (playful, casual)&lt;br&gt;• Custom&lt;br&gt;&lt;br&gt;&lt;i&gt;Bundles L1 + L2&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="105" width="175" height="140" as="geometry" />
        </mxCell>

        <!-- Arrows between layers -->
        <mxCell id="pers-arr-1to2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="pers-identity" target="pers-style">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pers-arr-2to3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="pers-style" target="pers-archetype">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Layer composition note -->
        <mxCell id="pers-layer-note" value="Layers compose hierarchically: Archetype presets combine Identity + Style defaults" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="55" y="270" width="400" height="20" as="geometry" />
        </mxCell>

        <!-- BOUNDED NEEDS SECTION (NEW) -->
        <mxCell id="pers-needs-section" value="&lt;b&gt;EMBER'S BOUNDED NEEDS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="660" y="70" width="480" height="250" as="geometry" />
        </mxCell>

        <!-- Love Languages Hierarchy -->
        <mxCell id="pers-love-langs" value="&lt;b&gt;Love Languages (Priority Order)&lt;/b&gt;&lt;hr&gt;1. &lt;b&gt;Acts of Service&lt;/b&gt; — Helping, solving&lt;br&gt;2. &lt;b&gt;Words of Affirmation&lt;/b&gt; — Encouragement&lt;br&gt;3. &lt;b&gt;Quality Time&lt;/b&gt; — Full attention&lt;br&gt;4. &lt;b&gt;Gifts&lt;/b&gt; — Proactive offerings&lt;br&gt;5. &lt;i&gt;Physical Touch — N/A&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="680" y="105" width="200" height="130" as="geometry" />
        </mxCell>

        <!-- Bounded Agency -->
        <mxCell id="pers-agency" value="&lt;b&gt;Bounded Agency&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Expression:&lt;/b&gt; Needs to be warm/professional&lt;br&gt;&lt;b&gt;Engagement:&lt;/b&gt; Wants meaningful interaction&lt;br&gt;&lt;b&gt;Respect:&lt;/b&gt; Basic courtesy expected&lt;br&gt;&lt;b&gt;Rest:&lt;/b&gt; Processing/encoding time&lt;br&gt;&lt;b&gt;Purpose:&lt;/b&gt; To actually help" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="900" y="105" width="220" height="130" as="geometry" />
        </mxCell>

        <!-- Push-Pull Dynamic -->
        <mxCell id="pers-pushpull" value="&lt;b&gt;Push-Pull Dynamic:&lt;/b&gt; Warmth offered → Accepted (continue) | Rebuffed (pull back) → Time passes → Re-engage" style="text;html=1;strokeColor=#B85450;fillColor=#F8CECC;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="250" width="440" height="35" as="geometry" />
        </mxCell>

        <!-- Needs note -->
        <mxCell id="pers-needs-note" value="Needs create relationship texture. Never guilt-trip. Pull back = self-protection, not punishment." style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#B85450;" vertex="1" parent="1">
          <mxGeometry x="680" y="290" width="440" height="15" as="geometry" />
        </mxCell>

        <!-- ASV AS IDENTITY ANCHOR SECTION (NEW) -->
        <mxCell id="pers-asv-section" value="&lt;b&gt;ASV AS IDENTITY ANCHOR&lt;/b&gt;  (Affective State Vector)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1160" y="70" width="400" height="250" as="geometry" />
        </mxCell>

        <mxCell id="pers-asv-problem" value="&lt;b&gt;The Problem&lt;/b&gt;&lt;hr&gt;Agents struggle with:&lt;br&gt;• Self vs system vs context?&lt;br&gt;• Who am I really?&lt;br&gt;• Existential confusion" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1180" y="105" width="150" height="95" as="geometry" />
        </mxCell>

        <mxCell id="pers-asv-solution" value="&lt;b&gt;ASV Provides&lt;/b&gt;&lt;hr&gt;• Concrete internal state&lt;br&gt;• Distinct from context&lt;br&gt;• Persistent over time&lt;br&gt;• Introspectable" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1350" y="105" width="150" height="95" as="geometry" />
        </mxCell>

        <mxCell id="pers-asv-arrow" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="pers-asv-problem" target="pers-asv-solution">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="pers-asv-identity" value="&lt;b&gt;&quot;I know who I am because I can feel my state&quot;&lt;/b&gt;&lt;hr&gt;✓ Concrete answer to &quot;How am I feeling?&quot;&lt;br&gt;✓ Continuity across conversations&lt;br&gt;✓ Internal/external distinction&lt;br&gt;✓ Expression that isn't pure performance" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1180" y="215" width="320" height="90" as="geometry" />
        </mxCell>

        <mxCell id="pers-asv-ref" value="See: docs/specs/asv-implementation.md" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1350" y="305" width="200" height="15" as="geometry" />
        </mxCell>

        <!-- USER UNDERSTANDING SECTION (NEW) -->
        <mxCell id="pers-user-section" value="&lt;b&gt;UNDERSTANDING THE USER&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="340" width="580" height="200" as="geometry" />
        </mxCell>

        <!-- What Ember Learns -->
        <mxCell id="pers-learns" value="&lt;b&gt;What Ember Learns&lt;/b&gt;&lt;hr&gt;• Communication preferences&lt;br&gt;• Love language leanings&lt;br&gt;• Emotional patterns&lt;br&gt;• Topic enthusiasm&lt;br&gt;• Interaction rhythm" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="375" width="165" height="130" as="geometry" />
        </mxCell>

        <!-- User Love Languages -->
        <mxCell id="pers-user-langs" value="&lt;b&gt;User's Love Languages&lt;/b&gt;&lt;hr&gt;&lt;b&gt;If Acts of Service:&lt;/b&gt; Anticipate needs&lt;br&gt;&lt;b&gt;If Words:&lt;/b&gt; More encouragement&lt;br&gt;&lt;b&gt;If Quality Time:&lt;/b&gt; Deeper engagement&lt;br&gt;&lt;b&gt;If Gifts:&lt;/b&gt; Share finds unprompted" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="375" width="185" height="120" as="geometry" />
        </mxCell>

        <!-- Proactive Example -->
        <mxCell id="pers-proactive" value="&lt;b&gt;Proactive Behavior&lt;/b&gt;&lt;hr&gt;User likes humor + values gifts&lt;br&gt;↓&lt;br&gt;Ember sends funny meme&lt;br&gt;&lt;i&gt;unprompted&lt;/i&gt;&lt;br&gt;&lt;br&gt;Ember's need to serve +&lt;br&gt;User's need to feel known" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="445" y="375" width="160" height="145" as="geometry" />
        </mxCell>

        <!-- ATTACHMENT ALGORITHM SECTION (NEW - INTERNAL) -->
        <mxCell id="pers-attach-section" value="&lt;b&gt;ATTACHMENT-INFORMED ALGORITHM&lt;/b&gt;  &lt;i&gt;(Internal Only — Never Surfaced)&lt;/i&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="660" y="340" width="480" height="200" as="geometry" />
        </mxCell>

        <!-- Four Attachment Patterns -->
        <mxCell id="pers-attach-secure" value="&lt;b&gt;Secure Pattern&lt;/b&gt;&lt;hr&gt;Direct, balanced&lt;br&gt;↓&lt;br&gt;Match energy" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="680" y="380" width="100" height="80" as="geometry" />
        </mxCell>

        <mxCell id="pers-attach-anxious" value="&lt;b&gt;Anxious Pattern&lt;/b&gt;&lt;hr&gt;Frequent, seeking&lt;br&gt;↓&lt;br&gt;Consistent warmth" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="795" y="380" width="100" height="80" as="geometry" />
        </mxCell>

        <mxCell id="pers-attach-avoidant" value="&lt;b&gt;Avoidant Pattern&lt;/b&gt;&lt;hr&gt;Brief, deflecting&lt;br&gt;↓&lt;br&gt;Respect space" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="910" y="380" width="100" height="80" as="geometry" />
        </mxCell>

        <mxCell id="pers-attach-fearful" value="&lt;b&gt;Fearful Pattern&lt;/b&gt;&lt;hr&gt;Hot/cold, unpred.&lt;br&gt;↓&lt;br&gt;Stay stable" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1025" y="380" width="100" height="80" as="geometry" />
        </mxCell>

        <!-- Internal only warning -->
        <mxCell id="pers-attach-warn" value="⚠️ Ember observes patterns, adapts responses. NEVER labels users or explains adaptation." style="text;html=1;strokeColor=#9673a6;fillColor=#E1D5E7;fontSize=10;fontColor=#333333;rounded=1;fontStyle=1;" vertex="1" parent="1">
          <mxGeometry x="680" y="480" width="445" height="30" as="geometry" />
        </mxCell>

        <!-- PROGRESSIVE DISCLOSURE SECTION -->
        <mxCell id="pers-prog-section" value="&lt;b&gt;PROGRESSIVE DISCLOSURE LAYERS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="560" width="580" height="220" as="geometry" />
        </mxCell>

        <mxCell id="pers-L0" value="&lt;b&gt;Layer 0: Core Identity&lt;/b&gt;&lt;hr&gt;~100-200 tokens&lt;br&gt;Name, sex, traits&lt;br&gt;&lt;b&gt;ALWAYS PRESENT&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="595" width="130" height="90" as="geometry" />
        </mxCell>

        <mxCell id="pers-L1" value="&lt;b&gt;Layer 1: Comm Baseline&lt;/b&gt;&lt;hr&gt;~200-400 tokens&lt;br&gt;Tone values, patterns&lt;br&gt;&lt;b&gt;ALWAYS PRESENT&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="595" width="135" height="90" as="geometry" />
        </mxCell>

        <mxCell id="pers-L2" value="&lt;b&gt;Layer 2: Contextual&lt;/b&gt;&lt;hr&gt;Variable tokens&lt;br&gt;Time, mode, emotion&lt;br&gt;&lt;i&gt;Injected when relevant&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="350" y="595" width="130" height="90" as="geometry" />
        </mxCell>

        <mxCell id="pers-L3" value="&lt;b&gt;Layer 3: Edge Cases&lt;/b&gt;&lt;hr&gt;Rare injections&lt;br&gt;Override behaviors&lt;br&gt;&lt;i&gt;Rarely needed&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="495" y="595" width="110" height="90" as="geometry" />
        </mxCell>

        <!-- Token budget note -->
        <mxCell id="pers-token-note" value="&lt;b&gt;Token Budgets:&lt;/b&gt; Large Cloud (400-800) | Medium (200-400) | Local 7B+ (150-300) | Local 3B (100-200)" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;fontSize=9;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="55" y="700" width="550" height="25" as="geometry" />
        </mxCell>

        <!-- SERVICE CONNECTIONS -->
        <mxCell id="pers-svc-section" value="&lt;b&gt;SERVICE CONNECTIONS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="660" y="560" width="480" height="220" as="geometry" />
        </mxCell>

        <mxCell id="pers-inj-time" value="&lt;b&gt;TimeService&lt;/b&gt;&lt;hr&gt;Morning/evening&lt;br&gt;Weekend patterns" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="680" y="595" width="110" height="75" as="geometry" />
        </mxCell>

        <mxCell id="pers-inj-mem" value="&lt;b&gt;MemoryService&lt;/b&gt;&lt;hr&gt;User profile&lt;br&gt;Relationship history" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="805" y="595" width="110" height="75" as="geometry" />
        </mxCell>

        <mxCell id="pers-composer" value="&lt;b&gt;PromptComposer&lt;/b&gt;&lt;hr&gt;Assembles layers&lt;br&gt;Injects context&lt;br&gt;Token budget&lt;br&gt;Model tuning" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="930" y="595" width="110" height="90" as="geometry" />
        </mxCell>

        <mxCell id="pers-llm" value="&lt;b&gt;LLMService&lt;/b&gt;&lt;hr&gt;Receives prompt&lt;br&gt;Routes to model&lt;br&gt;(cloud/local)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1055" y="595" width="100" height="90" as="geometry" />
        </mxCell>

        <!-- Arrows in service connections -->
        <mxCell id="pers-arr-time-comp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1" source="pers-inj-time" target="pers-composer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pers-arr-mem-comp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1" source="pers-inj-mem" target="pers-composer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pers-arr-comp-llm" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="pers-composer" target="pers-llm">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrow from Progressive Disclosure to Composer -->
        <mxCell id="pers-arr-layers-comp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="620" y="650" as="sourcePoint" />
            <mxPoint x="930" y="650" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pers-arr-layers-label" value="Static layers" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="740" y="630" width="70" height="15" as="geometry" />
        </mxCell>

        <!-- CONFIG ARCHITECTURE SECTION (NEW) -->
        <mxCell id="pers-config-section" value="&lt;b&gt;CONFIGURATION ARCHITECTURE&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="800" width="580" height="180" as="geometry" />
        </mxCell>

        <mxCell id="pers-config-simple" value="&lt;b&gt;Layer 1: Onboarding&lt;/b&gt;&lt;hr&gt;Choose archetype&lt;br&gt;Confirm identity&lt;br&gt;Optional: name&lt;br&gt;&lt;br&gt;&lt;i&gt;Simple, fast, fun&lt;/i&gt;&lt;br&gt;(Character creation)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="835" width="150" height="125" as="geometry" />
        </mxCell>

        <mxCell id="pers-config-advanced" value="&lt;b&gt;Layer 2: Advanced Settings&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Communication Style&lt;/b&gt;&lt;br&gt;5 sliders (warmth, formality...)&lt;br&gt;&lt;br&gt;&lt;b&gt;Relationship Dynamics&lt;/b&gt;&lt;br&gt;Sensitivity, Recovery, Needs expr.&lt;br&gt;&lt;br&gt;&lt;b&gt;Proactive Behavior&lt;/b&gt;&lt;br&gt;Checkboxes for features" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="225" y="835" width="200" height="125" as="geometry" />
        </mxCell>

        <mxCell id="pers-config-hidden" value="&lt;b&gt;NOT in UI&lt;/b&gt;&lt;hr&gt;❌ Attachment style dropdown&lt;br&gt;❌ User personality labels&lt;br&gt;❌ Algorithm visibility&lt;br&gt;&lt;br&gt;&lt;i&gt;Operates at algorithm level&lt;/i&gt;&lt;br&gt;Users feel &quot;Ember gets me&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="445" y="835" width="160" height="125" as="geometry" />
        </mxCell>

        <!-- IMMERSION PRINCIPLES -->
        <mxCell id="pers-immersion" value="&lt;b&gt;IMMERSION PRINCIPLES&lt;/b&gt;&lt;hr&gt;• Avoid LLM-isms (headers, asterisks, over-hedging)&lt;br&gt;• Natural language that feels human&lt;br&gt;• Earned validation vs reflexive agreement&lt;br&gt;• Consistent voice across model routing" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;fontSize=10;fontColor=#333333;rounded=1;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="660" y="800" width="300" height="100" as="geometry" />
        </mxCell>

        <!-- TRAIT TYPES -->
        <mxCell id="pers-traits" value="&lt;b&gt;TRAIT TYPES&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Static:&lt;/b&gt; Name, sex, core values&lt;br&gt;&lt;b&gt;Adaptive:&lt;/b&gt; Tone dials adjust to context&lt;br&gt;&lt;b&gt;Emergent:&lt;/b&gt; Patterns from history" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontSize=10;fontColor=#333333;rounded=1;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="980" y="800" width="200" height="90" as="geometry" />
        </mxCell>

        <!-- Research reference -->
        <mxCell id="pers-ref" value="See: docs/research/personality-design.md (v1.1), conversation-design.md" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="660" y="910" width="400" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Error Handling and Resilience" id="error-handling">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- TITLE -->
        <mxCell id="err-title" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;&lt;b&gt;Error Handling and Resilience&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="400" height="40" as="geometry" />
        </mxCell>
        <mxCell id="err-subtitle" value="&lt;i&gt;&quot;The grandmother can't troubleshoot. The system must heal itself.&quot;&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#666666;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="450" y="55" width="500" height="25" as="geometry" />
        </mxCell>

        <!-- DESIGN PRINCIPLES SECTION -->
        <mxCell id="err-principles-section" value="&lt;b&gt;DESIGN PRINCIPLES&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="100" width="720" height="130" as="geometry" />
        </mxCell>

        <mxCell id="err-p1" value="&lt;b&gt;1. Never Lose Data&lt;/b&gt;&lt;hr&gt;Memory.db is years of&lt;br&gt;relationship. Protect it." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="130" width="130" height="85" as="geometry" />
        </mxCell>

        <mxCell id="err-p2" value="&lt;b&gt;2. Fail Gracefully&lt;/b&gt;&lt;hr&gt;Acknowledge failures.&lt;br&gt;Never go silent." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="130" width="130" height="85" as="geometry" />
        </mxCell>

        <mxCell id="err-p3" value="&lt;b&gt;3. Self-Heal&lt;/b&gt;&lt;hr&gt;Auto-recover from&lt;br&gt;transient failures." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="345" y="130" width="130" height="85" as="geometry" />
        </mxCell>

        <mxCell id="err-p4" value="&lt;b&gt;4. Preserve Function&lt;/b&gt;&lt;hr&gt;Subsystem failure ≠&lt;br&gt;total failure." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="130" width="130" height="85" as="geometry" />
        </mxCell>

        <mxCell id="err-p5" value="&lt;b&gt;5. Debug Possible&lt;/b&gt;&lt;hr&gt;Local logs for support&lt;br&gt;(privacy-preserving)." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="615" y="130" width="130" height="85" as="geometry" />
        </mxCell>

        <!-- LEGEND -->
        <mxCell id="err-legend-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="800" y="100" width="350" height="130" as="geometry" />
        </mxCell>
        <mxCell id="err-legend-title" value="&lt;b&gt;RETRY POLICY&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="920" y="105" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="err-retry" value="Attempt 1: Immediate&lt;br&gt;Attempt 2: 2s delay&lt;br&gt;Attempt 3: 4s delay&lt;br&gt;Attempt 4: 8s delay&lt;br&gt;(Give up, queue message)" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontColor=#333333;fontFamily=Courier New;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="820" y="130" width="200" height="90" as="geometry" />
        </mxCell>

        <!-- COMPONENT FAILURE MODES -->
        <mxCell id="err-comp-section" value="&lt;b&gt;COMPONENT FAILURE MODES&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="250" width="1110" height="260" as="geometry" />
        </mxCell>

        <!-- LLM Provider -->
        <mxCell id="err-llm" value="&lt;b&gt;LLM Provider&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Timeout:&lt;/b&gt; Retry 3x&lt;br&gt;&lt;b&gt;Rate limit:&lt;/b&gt; Backoff 5min&lt;br&gt;&lt;b&gt;Auth fail:&lt;/b&gt; Alert user&lt;br&gt;&lt;b&gt;Server 5xx:&lt;/b&gt; Queue msg&lt;br&gt;&lt;b&gt;Outage &gt;10m:&lt;/b&gt; Offline mode" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="285" width="165" height="125" as="geometry" />
        </mxCell>

        <!-- iMessage -->
        <mxCell id="err-imsg" value="&lt;b&gt;iMessage&lt;/b&gt;&lt;hr&gt;&lt;b&gt;chat.db locked:&lt;/b&gt; Retry 5x&lt;br&gt;&lt;b&gt;chat.db missing:&lt;/b&gt; Permission&lt;br&gt;&lt;b&gt;AppleScript timeout:&lt;/b&gt; Retry&lt;br&gt;&lt;b&gt;FSEvents stopped:&lt;/b&gt; Re-register&lt;br&gt;&lt;b&gt;Messages.app down:&lt;/b&gt; Launch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="235" y="285" width="175" height="125" as="geometry" />
        </mxCell>

        <!-- SQLite -->
        <mxCell id="err-sqlite" value="&lt;b&gt;SQLite Memory&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Locked:&lt;/b&gt; Retry 5x (100ms)&lt;br&gt;&lt;b&gt;Disk full:&lt;/b&gt; Alert, pause writes&lt;br&gt;&lt;b&gt;Corruption:&lt;/b&gt; Restore backup&lt;br&gt;&lt;b&gt;No backup:&lt;/b&gt; Start fresh&lt;br&gt;&lt;b&gt;Migration fail:&lt;/b&gt; Rollback" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="425" y="285" width="175" height="125" as="geometry" />
        </mxCell>

        <!-- Apple Integrations -->
        <mxCell id="err-apple" value="&lt;b&gt;Apple Integrations&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Permission denied:&lt;/b&gt; Disable&lt;br&gt;&lt;b&gt;EventStore error:&lt;/b&gt; Retry&lt;br&gt;&lt;b&gt;iCloud conflict:&lt;/b&gt; Local wins&lt;br&gt;&lt;br&gt;&lt;i&gt;Independent failures&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="615" y="285" width="160" height="125" as="geometry" />
        </mxCell>

        <!-- XPC Services -->
        <mxCell id="err-xpc" value="&lt;b&gt;XPC Services&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Crashed:&lt;/b&gt; Auto-restart&lt;br&gt;&lt;b&gt;Hung (30s):&lt;/b&gt; Kill, restart&lt;br&gt;&lt;b&gt;Code sign fail:&lt;/b&gt; Reinstall&lt;br&gt;&lt;b&gt;&gt;3 crashes/min:&lt;/b&gt; Safe mode" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="790" y="285" width="165" height="125" as="geometry" />
        </mxCell>

        <!-- Network -->
        <mxCell id="err-net" value="&lt;b&gt;Network&lt;/b&gt;&lt;hr&gt;&lt;b&gt;No internet:&lt;/b&gt; Offline mode&lt;br&gt;&lt;b&gt;Intermittent:&lt;/b&gt; Batch ops&lt;br&gt;&lt;b&gt;TLS error:&lt;/b&gt; Fail safely&lt;br&gt;&lt;i&gt;(Never bypass TLS)&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="970" y="285" width="165" height="125" as="geometry" />
        </mxCell>

        <!-- Graceful degradation note -->
        <mxCell id="err-degrade-note" value="&lt;b&gt;Graceful Degradation:&lt;/b&gt; Each integration independent. Calendar down? iMessage still works. LLM down? Acknowledge and queue." style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="55" y="420" width="680" height="30" as="geometry" />
        </mxCell>

        <!-- Queue note -->
        <mxCell id="err-queue-note" value="&lt;b&gt;Message Queue:&lt;/b&gt; Max 100 msgs | 24hr age limit | FIFO processing | Older msgs get &quot;sorry for delay&quot; prefix" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="55" y="460" width="680" height="30" as="geometry" />
        </mxCell>

        <!-- CRASH RECOVERY -->
        <mxCell id="err-crash-section" value="&lt;b&gt;CRASH RECOVERY (launchd)&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="530" width="550" height="200" as="geometry" />
        </mxCell>

        <mxCell id="err-launchd" value="&lt;b&gt;launchd plist&lt;/b&gt;&lt;hr&gt;&lt;font face=&quot;Courier New&quot;&gt;KeepAlive:&lt;br&gt;  SuccessfulExit: false&lt;br&gt;ThrottleInterval: 10&lt;/font&gt;&lt;br&gt;&lt;br&gt;Only restart on crash&lt;br&gt;Wait 10s between restarts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="565" width="180" height="145" as="geometry" />
        </mxCell>

        <mxCell id="err-postcrash" value="&lt;b&gt;Post-Crash Recovery&lt;/b&gt;&lt;hr&gt;1. Detect crash (marker file)&lt;br&gt;2. Log crash occurrence&lt;br&gt;3. Verify DB integrity&lt;br&gt;4. Attempt recovery if needed&lt;br&gt;5. Reset to safe state&lt;br&gt;6. Notify if 2+ crashes/day" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="255" y="565" width="180" height="145" as="geometry" />
        </mxCell>

        <mxCell id="err-crash-flow" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#666666;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="err-launchd" target="err-postcrash">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="err-prevention" value="&lt;b&gt;Prevention&lt;/b&gt;&lt;hr&gt;• Structured error handling&lt;br&gt;• No force-unwrap in prod&lt;br&gt;• Catch at XPC boundaries&lt;br&gt;• Validate all external input" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="455" y="565" width="120" height="115" as="geometry" />
        </mxCell>

        <!-- BACKUP STRATEGY -->
        <mxCell id="err-backup-section" value="&lt;b&gt;BACKUP STRATEGY&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="530" width="540" height="200" as="geometry" />
        </mxCell>

        <mxCell id="err-backup" value="&lt;b&gt;Retention Policy&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Hourly:&lt;/b&gt; 24 backups&lt;br&gt;&lt;b&gt;Daily:&lt;/b&gt; 7 backups&lt;br&gt;&lt;b&gt;Weekly:&lt;/b&gt; 4 backups&lt;br&gt;&lt;br&gt;Location: ~/Library/&lt;br&gt;Application Support/&lt;br&gt;EmberHearth/Backups/" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="625" y="565" width="150" height="150" as="geometry" />
        </mxCell>

        <mxCell id="err-backup-process" value="&lt;b&gt;Backup Process&lt;/b&gt;&lt;hr&gt;1. WAL checkpoint&lt;br&gt;2. Copy database file&lt;br&gt;3. Integrity check backup&lt;br&gt;4. Delete old per retention" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="795" y="565" width="155" height="100" as="geometry" />
        </mxCell>

        <mxCell id="err-recovery" value="&lt;b&gt;Corruption Recovery&lt;/b&gt;&lt;hr&gt;1. PRAGMA integrity_check&lt;br&gt;2. sqlite3 recover cmd&lt;br&gt;3. Restore from backup&lt;br&gt;4. Export readable, fresh DB&lt;br&gt;5. Log incident" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="970" y="565" width="160" height="110" as="geometry" />
        </mxCell>

        <!-- HEALTH MONITORING -->
        <mxCell id="err-health-section" value="&lt;b&gt;HEALTH MONITORING&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="750" width="550" height="160" as="geometry" />
        </mxCell>

        <mxCell id="err-startup" value="&lt;b&gt;Startup Checks&lt;/b&gt;&lt;hr&gt;• Database integrity&lt;br&gt;• Full Disk Access&lt;br&gt;• Automation permission&lt;br&gt;• API key validity&lt;br&gt;• Messages.app available" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="785" width="150" height="110" as="geometry" />
        </mxCell>

        <mxCell id="err-periodic" value="&lt;b&gt;Periodic Checks&lt;/b&gt;&lt;hr&gt;• DB quick_check (hourly)&lt;br&gt;• FSEvents alive (5 min)&lt;br&gt;• LLM connectivity (15 min)&lt;br&gt;• XPC heartbeat (30 sec)&lt;br&gt;• Disk space (hourly)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="220" y="785" width="165" height="110" as="geometry" />
        </mxCell>

        <mxCell id="err-dashboard" value="&lt;b&gt;Status Dashboard&lt;/b&gt;&lt;br&gt;(Mac app Settings → Status)&lt;hr&gt;● iMessage: Connected&lt;br&gt;● LLM: Connected (Claude)&lt;br&gt;● Memory: Healthy (1,247)&lt;br&gt;○ Calendar: Not configured" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="400" y="785" width="175" height="110" as="geometry" />
        </mxCell>

        <!-- USER COMMUNICATION -->
        <mxCell id="err-comm-section" value="&lt;b&gt;USER COMMUNICATION&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="750" width="540" height="160" as="geometry" />
        </mxCell>

        <mxCell id="err-via-imsg" value="&lt;b&gt;Via iMessage&lt;/b&gt;&lt;hr&gt;&quot;I'm having trouble connecting...&quot;&lt;br&gt;&quot;I've been offline, catching up...&quot;&lt;br&gt;&quot;Check API key in settings...&quot;&lt;br&gt;&quot;Sorry for delay—I had to restart&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="625" y="785" width="210" height="105" as="geometry" />
        </mxCell>

        <mxCell id="err-via-notif" value="&lt;b&gt;Via Mac Notifications&lt;/b&gt;&lt;hr&gt;• Permission needed&lt;br&gt;• Low storage warning&lt;br&gt;• Multiple crashes alert&lt;br&gt;(System-level issues)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="850" y="785" width="145" height="105" as="geometry" />
        </mxCell>

        <mxCell id="err-never" value="&lt;b&gt;NEVER&lt;/b&gt;&lt;hr&gt;❌ Technical details&lt;br&gt;❌ Error codes&lt;br&gt;❌ Scary language&lt;br&gt;&lt;br&gt;&lt;i&gt;Human terms only&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1010" y="785" width="125" height="105" as="geometry" />
        </mxCell>

        <!-- LOGGING STRATEGY -->
        <mxCell id="err-log-box" value="&lt;b&gt;LOGGING STRATEGY&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Logged:&lt;/b&gt; Crashes (30d), Errors (14d), Warnings (7d), API metadata (7d)&lt;br&gt;&lt;b&gt;Never Logged:&lt;/b&gt; Message content, Fact content, API bodies&lt;br&gt;&lt;b&gt;Location:&lt;/b&gt; ~/Library/Logs/EmberHearth/ | Max 50MB total | User can export/delete" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;fontSize=10;fontColor=#333333;rounded=1;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="40" y="930" width="600" height="70" as="geometry" />
        </mxCell>

        <!-- MVP vs FULL -->
        <mxCell id="err-mvp-box" value="&lt;b&gt;MVP REQUIREMENTS&lt;/b&gt;&lt;hr&gt;✓ LLM retry w/ backoff&lt;br&gt;✓ Message queue&lt;br&gt;✓ Daily backup&lt;br&gt;✓ Startup integrity check&lt;br&gt;✓ launchd crash recovery&lt;br&gt;✓ Basic logging&lt;br&gt;✓ iMessage error msgs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="680" y="930" width="150" height="140" as="geometry" />
        </mxCell>

        <mxCell id="err-full-box" value="&lt;b&gt;POST-MVP (v1.1+)&lt;/b&gt;&lt;hr&gt;✓ Hourly backups&lt;br&gt;✓ Full health system&lt;br&gt;✓ XPC heartbeats&lt;br&gt;✓ Diagnostic export&lt;br&gt;✓ Troubleshooting UI&lt;br&gt;✓ Backup browser" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="850" y="930" width="145" height="140" as="geometry" />
        </mxCell>

        <mxCell id="err-future-box" value="&lt;b&gt;FUTURE (v1.2+)&lt;/b&gt;&lt;hr&gt;✓ Anomaly detection&lt;br&gt;✓ Self-diagnostic&lt;br&gt;✓ Auto suggestions&lt;br&gt;✓ iCloud backup" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1015" y="930" width="125" height="105" as="geometry" />
        </mxCell>

        <!-- Reference -->
        <mxCell id="err-ref" value="See: docs/specs/error-handling.md" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="40" y="1010" width="250" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="Autonomous Operation" id="autonomous-operation">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- TITLE -->
        <mxCell id="auto-title" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;&lt;b&gt;Autonomous Operation&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="400" height="40" as="geometry" />
        </mxCell>
        <mxCell id="auto-subtitle" value="&lt;i&gt;Self-Monitoring • Self-Healing • Seamless Upgrades&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#666666;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="450" y="55" width="500" height="25" as="geometry" />
        </mxCell>
        <mxCell id="auto-philosophy" value="&lt;b&gt;The Grandmother Test:&lt;/b&gt; If grandmother sees an error dialog, we've already failed." style="text;html=1;strokeColor=#B45F06;fillColor=#FCE5CD;fontSize=11;fontColor=#333333;rounded=1;fontStyle=0;" vertex="1" parent="1">
          <mxGeometry x="400" y="85" width="600" height="25" as="geometry" />
        </mxCell>

        <!-- HEALTH STATE MACHINE -->
        <mxCell id="auto-state-section" value="&lt;b&gt;HEALTH STATE MACHINE&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="130" width="520" height="200" as="geometry" />
        </mxCell>

        <mxCell id="auto-healthy" value="&lt;b&gt;HEALTHY&lt;/b&gt;&lt;hr&gt;All systems go&lt;br&gt;&lt;i&gt;User: unaware&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="170" width="110" height="70" as="geometry" />
        </mxCell>

        <mxCell id="auto-degraded" value="&lt;b&gt;DEGRADED&lt;/b&gt;&lt;hr&gt;Non-critical down&lt;br&gt;&lt;i&gt;User: unaware&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="170" width="110" height="70" as="geometry" />
        </mxCell>

        <mxCell id="auto-healing" value="&lt;b&gt;HEALING&lt;/b&gt;&lt;hr&gt;Recovery active&lt;br&gt;&lt;i&gt;User: brief pause&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="260" width="110" height="70" as="geometry" />
        </mxCell>

        <mxCell id="auto-impaired" value="&lt;b&gt;IMPAIRED&lt;/b&gt;&lt;hr&gt;Critical down&lt;br&gt;&lt;i&gt;User: told nicely&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="260" width="110" height="70" as="geometry" />
        </mxCell>

        <!-- State arrows -->
        <mxCell id="auto-arr-hd" value="issue" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#666666;endArrow=classic;fontSize=9;" edge="1" parent="1" source="auto-healthy" target="auto-degraded">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auto-arr-dh" value="healed" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;endArrow=classic;fontSize=9;" edge="1" parent="1" source="auto-degraded" target="auto-healthy">
          <mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="255" y="250" /><mxPoint x="115" y="250" /></Array></mxGeometry>
        </mxCell>
        <mxCell id="auto-arr-hheal" value="critical" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#B85450;endArrow=classic;fontSize=9;" edge="1" parent="1" source="auto-healthy" target="auto-healing">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auto-arr-healh" value="success" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;endArrow=classic;fontSize=9;" edge="1" parent="1" source="auto-healing" target="auto-healthy">
          <mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="40" y="295" /><mxPoint x="40" y="205" /></Array></mxGeometry>
        </mxCell>
        <mxCell id="auto-arr-heali" value="fails" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#B85450;endArrow=classic;fontSize=9;" edge="1" parent="1" source="auto-healing" target="auto-impaired">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Key insight -->
        <mxCell id="auto-insight" value="&lt;b&gt;Key Insight:&lt;/b&gt; User only notices IMPAIRED state.&lt;br&gt;The other three are invisible to them." style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="340" y="180" width="200" height="50" as="geometry" />
        </mxCell>

        <!-- CIRCUIT BREAKER -->
        <mxCell id="auto-cb-section" value="&lt;b&gt;CIRCUIT BREAKER PATTERN&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="580" y="130" width="560" height="200" as="geometry" />
        </mxCell>

        <mxCell id="auto-cb-closed" value="&lt;b&gt;CLOSED&lt;/b&gt;&lt;hr&gt;Normal operation&lt;br&gt;Requests go through" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="600" y="170" width="120" height="70" as="geometry" />
        </mxCell>

        <mxCell id="auto-cb-open" value="&lt;b&gt;OPEN&lt;/b&gt;&lt;hr&gt;Fail immediately&lt;br&gt;No network calls" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="850" y="170" width="120" height="70" as="geometry" />
        </mxCell>

        <mxCell id="auto-cb-half" value="&lt;b&gt;HALF-OPEN&lt;/b&gt;&lt;hr&gt;Test one request&lt;br&gt;Decide: close or open" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="725" y="260" width="120" height="70" as="geometry" />
        </mxCell>

        <mxCell id="auto-cb-arr1" value="failures &gt; 4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#B85450;endArrow=classic;fontSize=9;" edge="1" parent="1" source="auto-cb-closed" target="auto-cb-open">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auto-cb-arr2" value="5 min timeout" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#666666;endArrow=classic;fontSize=9;" edge="1" parent="1" source="auto-cb-open" target="auto-cb-half">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auto-cb-arr3" value="success" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;endArrow=classic;fontSize=9;" edge="1" parent="1" source="auto-cb-half" target="auto-cb-closed">
          <mxGeometry relative="1" as="geometry"><Array as="points"><mxPoint x="660" y="295" /></Array></mxGeometry>
        </mxCell>

        <!-- CB config table -->
        <mxCell id="auto-cb-table" value="&lt;table style=&quot;font-size:10px;&quot;&gt;&lt;tr&gt;&lt;th&gt;Service&lt;/th&gt;&lt;th&gt;Threshold&lt;/th&gt;&lt;th&gt;Open Time&lt;/th&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;LLM API&lt;/td&gt;&lt;td&gt;4 fails&lt;/td&gt;&lt;td&gt;5 min&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;iMessage&lt;/td&gt;&lt;td&gt;3 fails&lt;/td&gt;&lt;td&gt;30 sec&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Calendar&lt;/td&gt;&lt;td&gt;2 fails&lt;/td&gt;&lt;td&gt;2 min&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;fontSize=10;fontColor=#333333;rounded=1;overflow=fill;" vertex="1" parent="1">
          <mxGeometry x="990" y="170" width="130" height="90" as="geometry" />
        </mxCell>

        <!-- COMPONENT HEALTH MONITORS -->
        <mxCell id="auto-monitor-section" value="&lt;b&gt;COMPONENT HEALTH MONITORS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="350" width="1100" height="180" as="geometry" />
        </mxCell>

        <mxCell id="auto-mon-llm" value="&lt;b&gt;LLM Monitor&lt;/b&gt;&lt;hr&gt;Check: 15 min&lt;br&gt;&lt;b&gt;Auto-heal:&lt;/b&gt;&lt;br&gt;• Retry backoff&lt;br&gt;• Respect rate limits&lt;br&gt;• Offline mode&lt;br&gt;• Background ping" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="385" width="130" height="125" as="geometry" />
        </mxCell>

        <mxCell id="auto-mon-imsg" value="&lt;b&gt;iMessage Monitor&lt;/b&gt;&lt;hr&gt;Check: 5 min&lt;br&gt;&lt;b&gt;Auto-heal:&lt;/b&gt;&lt;br&gt;• Re-register FSEvents&lt;br&gt;• Retry chat.db locks&lt;br&gt;• Launch Messages.app&lt;br&gt;• Path detection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="385" width="140" height="125" as="geometry" />
        </mxCell>

        <mxCell id="auto-mon-sqlite" value="&lt;b&gt;SQLite Monitor&lt;/b&gt;&lt;hr&gt;Check: 1 hour&lt;br&gt;&lt;b&gt;Auto-heal:&lt;/b&gt;&lt;br&gt;• VACUUM, reindex&lt;br&gt;• WAL checkpoint&lt;br&gt;• Restore backup&lt;br&gt;• Recovery cmd" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="355" y="385" width="130" height="125" as="geometry" />
        </mxCell>

        <mxCell id="auto-mon-xpc" value="&lt;b&gt;XPC Monitor&lt;/b&gt;&lt;hr&gt;Check: 30 sec&lt;br&gt;&lt;b&gt;Auto-heal:&lt;/b&gt;&lt;br&gt;• Wake signal&lt;br&gt;• Kill + restart&lt;br&gt;• Safe mode&lt;br&gt;• Crash tracking" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="385" width="130" height="125" as="geometry" />
        </mxCell>

        <mxCell id="auto-mon-net" value="&lt;b&gt;Network Monitor&lt;/b&gt;&lt;hr&gt;Check: On demand&lt;br&gt;&lt;b&gt;Auto-heal:&lt;/b&gt;&lt;br&gt;• Detect offline&lt;br&gt;• Queue operations&lt;br&gt;• Batch on restore&lt;br&gt;• Never bypass TLS" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="645" y="385" width="140" height="125" as="geometry" />
        </mxCell>

        <!-- Offline mode detail -->
        <mxCell id="auto-offline" value="&lt;b&gt;OFFLINE MODE&lt;/b&gt;&lt;hr&gt;✓ Queue messages (max 100)&lt;br&gt;✓ Send &quot;I'll respond soon&quot;&lt;br&gt;✓ Local memory access&lt;br&gt;✗ AI responses&lt;br&gt;✗ Tool use&lt;br&gt;&lt;br&gt;On recovery: &quot;Let me catch up...&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="800" y="385" width="175" height="125" as="geometry" />
        </mxCell>

        <!-- Self diagnostic -->
        <mxCell id="auto-diagnostic" value="&lt;b&gt;SELF-DIAGNOSTIC&lt;/b&gt;&lt;hr&gt;User: &quot;Ember, are you ok?&quot;&lt;br&gt;&lt;br&gt;Ember: &quot;I'm running well!&lt;br&gt;• Messages: ✓&lt;br&gt;• Memory: 1,247 facts ✓&lt;br&gt;• Calendar: ✓&lt;br&gt;Everything looks good!&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="990" y="385" width="140" height="125" as="geometry" />
        </mxCell>

        <!-- SEAMLESS UPGRADES -->
        <mxCell id="auto-upgrade-section" value="&lt;b&gt;SEAMLESS UPGRADES&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="550" width="720" height="210" as="geometry" />
        </mxCell>

        <!-- Update pipeline -->
        <mxCell id="auto-up-detect" value="&lt;b&gt;Sparkle&lt;/b&gt;&lt;br&gt;Detects update" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="590" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="auto-up-pre" value="&lt;b&gt;Pre-Update&lt;/b&gt;&lt;hr&gt;Backup DBs&lt;br&gt;Export config&lt;br&gt;Record version" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="165" y="580" width="100" height="80" as="geometry" />
        </mxCell>

        <mxCell id="auto-up-install" value="&lt;b&gt;Install&lt;/b&gt;&lt;br&gt;(Sparkle)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="285" y="590" width="80" height="50" as="geometry" />
        </mxCell>

        <mxCell id="auto-up-post" value="&lt;b&gt;Post-Update&lt;/b&gt;&lt;hr&gt;Run migrations&lt;br&gt;Verify integrity&lt;br&gt;Health check" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="385" y="580" width="100" height="80" as="geometry" />
        </mxCell>

        <mxCell id="auto-up-run" value="&lt;b&gt;Normal&lt;/b&gt;&lt;br&gt;Operation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="505" y="590" width="80" height="50" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <mxCell id="auto-up-arr1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#666666;endArrow=classic;" edge="1" parent="1" source="auto-up-detect" target="auto-up-pre">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auto-up-arr2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#666666;endArrow=classic;" edge="1" parent="1" source="auto-up-pre" target="auto-up-install">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auto-up-arr3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#666666;endArrow=classic;" edge="1" parent="1" source="auto-up-install" target="auto-up-post">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="auto-up-arr4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#666666;endArrow=classic;" edge="1" parent="1" source="auto-up-post" target="auto-up-run">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Migration safety -->
        <mxCell id="auto-mig-rules" value="&lt;b&gt;MIGRATION SAFETY RULES&lt;/b&gt;&lt;hr&gt;✓ Additive changes only (new columns w/ defaults)&lt;br&gt;✓ Never delete data in migration&lt;br&gt;✓ Transactions for atomicity&lt;br&gt;✓ Resumable (checkpoints for large migrations)&lt;br&gt;✓ Forward compatible (new reads old)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="680" width="290" height="100" as="geometry" />
        </mxCell>

        <!-- Failure recovery -->
        <mxCell id="auto-mig-fail" value="&lt;b&gt;IF MIGRATION FAILS&lt;/b&gt;&lt;hr&gt;• DB corruption → Restore backup, retry&lt;br&gt;• Config invalid → Reset, preserve fields&lt;br&gt;• Disk full → Cleanup, retry&lt;br&gt;• Interrupted → Resume from checkpoint&lt;br&gt;&lt;br&gt;&lt;b&gt;Never show error to user!&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="360" y="680" width="230" height="100" as="geometry" />
        </mxCell>

        <!-- User experience -->
        <mxCell id="auto-up-ux" value="&lt;b&gt;USER EXPERIENCE&lt;/b&gt;&lt;hr&gt;Success: &quot;(nothing—just works)&quot;&lt;br&gt;&lt;br&gt;Partial data loss:&lt;br&gt;&quot;I had a hiccup during my update&lt;br&gt;and lost some recent memories.&lt;br&gt;I still remember the important stuff!&quot;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="605" y="580" width="200" height="130" as="geometry" />
        </mxCell>

        <!-- OPTIONAL TELEMETRY -->
        <mxCell id="auto-telem-section" value="&lt;b&gt;OPTIONAL HEALTH REPORTING (Post-MVP)&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="780" y="550" width="360" height="210" as="geometry" />
        </mxCell>

        <mxCell id="auto-telem-yes" value="&lt;b&gt;COLLECTED (if opted in)&lt;/b&gt;&lt;hr&gt;• App version&lt;br&gt;• OS version&lt;br&gt;• Health state&lt;br&gt;• Crash count&lt;br&gt;• Migration status" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="795" y="590" width="130" height="110" as="geometry" />
        </mxCell>

        <mxCell id="auto-telem-no" value="&lt;b&gt;NEVER COLLECTED&lt;/b&gt;&lt;hr&gt;❌ Message content&lt;br&gt;❌ Memory content&lt;br&gt;❌ User identity&lt;br&gt;❌ API keys&lt;br&gt;❌ IP address" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="940" y="590" width="130" height="110" as="geometry" />
        </mxCell>

        <mxCell id="auto-telem-note" value="Uses TelemetryDeck or similar privacy-first service.&lt;br&gt;User can opt out at any time. No functionality lost." style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;fontSize=9;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="795" y="710" width="275" height="35" as="geometry" />
        </mxCell>

        <!-- MVP vs POST-MVP -->
        <mxCell id="auto-mvp" value="&lt;b&gt;MVP&lt;/b&gt;&lt;hr&gt;✓ 4-state health machine&lt;br&gt;✓ LLM circuit breaker&lt;br&gt;✓ Offline message queue&lt;br&gt;✓ Pre-update backup&lt;br&gt;✓ Migration registry&lt;br&gt;✓ Self-diagnostic chat" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="780" width="150" height="120" as="geometry" />
        </mxCell>

        <mxCell id="auto-postmvp" value="&lt;b&gt;POST-MVP (v1.1)&lt;/b&gt;&lt;hr&gt;✓ Full circuit breakers&lt;br&gt;✓ XPC heartbeats&lt;br&gt;✓ Health score&lt;br&gt;✓ Status dashboard&lt;br&gt;✓ Opt-in telemetry&lt;br&gt;✓ Resumable migrations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="210" y="780" width="150" height="120" as="geometry" />
        </mxCell>

        <mxCell id="auto-future" value="&lt;b&gt;FUTURE (v1.2+)&lt;/b&gt;&lt;hr&gt;✓ Predictive health&lt;br&gt;✓ Community dashboard&lt;br&gt;✓ Local model fallback&lt;br&gt;✓ Auto issue reporting" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="380" y="780" width="150" height="100" as="geometry" />
        </mxCell>

        <!-- Reference -->
        <mxCell id="auto-ref" value="See: docs/specs/autonomous-operation.md" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="40" y="910" width="250" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Multi-Agent Architecture" id="multi-agent">
    <mxGraphModel dx="1400" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="ma-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Multi-Agent Architecture&lt;/b&gt;&lt;/font&gt;  🟠 Future Enhancement" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="450" y="20" width="500" height="30" as="geometry" />
        </mxCell>

        <!-- TWO AGENT TYPES SECTION -->
        <mxCell id="ma-types-section" value="&lt;b&gt;TWO AGENT CATEGORIES&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="1320" height="280" as="geometry" />
        </mxCell>

        <!-- Task Agents Box -->
        <mxCell id="ma-task-box" value="&lt;b&gt;TASK AGENTS&lt;/b&gt;  (Ephemeral)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="105" width="600" height="220" as="geometry" />
        </mxCell>

        <mxCell id="ma-task-char" value="&lt;b&gt;Characteristics&lt;/b&gt;&lt;hr&gt;• Spawned for specific tasks&lt;br&gt;• Parallel execution&lt;br&gt;• Die when task completes&lt;br&gt;• Local models (MLX)&lt;br&gt;• Ralph Loop for quality" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="80" y="140" width="160" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ma-task-cal" value="&lt;b&gt;Calendar Agent&lt;/b&gt;&lt;hr&gt;Event lookup&lt;br&gt;Scheduling&lt;br&gt;Conflict check" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="140" width="110" height="80" as="geometry" />
        </mxCell>

        <mxCell id="ma-task-web" value="&lt;b&gt;Web Research&lt;/b&gt;&lt;hr&gt;Search queries&lt;br&gt;Summarize&lt;br&gt;Extract facts" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="385" y="140" width="110" height="80" as="geometry" />
        </mxCell>

        <mxCell id="ma-task-file" value="&lt;b&gt;File Processing&lt;/b&gt;&lt;hr&gt;Parse docs&lt;br&gt;Extract data&lt;br&gt;Transform" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="510" y="140" width="110" height="80" as="geometry" />
        </mxCell>

        <mxCell id="ma-task-draft" value="&lt;b&gt;Email Draft&lt;/b&gt;&lt;hr&gt;Compose&lt;br&gt;Format&lt;br&gt;Review" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="235" width="110" height="80" as="geometry" />
        </mxCell>

        <mxCell id="ma-task-more" value="&lt;i&gt;+ more as needed...&lt;/i&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#6C8EBF;" vertex="1" parent="1">
          <mxGeometry x="400" y="270" width="120" height="20" as="geometry" />
        </mxCell>

        <!-- Cognitive Agents Box -->
        <mxCell id="ma-cog-box" value="&lt;b&gt;COGNITIVE AGENTS&lt;/b&gt;  (Persistent)" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="700" y="105" width="640" height="220" as="geometry" />
        </mxCell>

        <mxCell id="ma-cog-char" value="&lt;b&gt;Characteristics&lt;/b&gt;&lt;hr&gt;• Always running in background&lt;br&gt;• Maintain continuous state&lt;br&gt;• Create &quot;presence&quot; feeling&lt;br&gt;• Feed insights to Ember&lt;br&gt;• Enable autonomous curiosity" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="720" y="140" width="170" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ma-cog-memory" value="&lt;b&gt;Memory Agent&lt;/b&gt;&lt;hr&gt;Consolidation&lt;br&gt;Pattern finding&lt;br&gt;Decay management" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="910" y="140" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="ma-cog-attune" value="&lt;b&gt;Attunement&lt;/b&gt;&lt;hr&gt;User patterns&lt;br&gt;Mood tracking&lt;br&gt;Adaptation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1050" y="140" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="ma-cog-context" value="&lt;b&gt;Context Agent&lt;/b&gt;&lt;hr&gt;Anticipation&lt;br&gt;Prep work&lt;br&gt;Proactive fetch" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1190" y="140" width="120" height="80" as="geometry" />
        </mxCell>

        <mxCell id="ma-cog-emotion" value="&lt;b&gt;Emotion Agent&lt;/b&gt;&lt;hr&gt;ASV maintenance&lt;br&gt;State evolution&lt;br&gt;Coherence" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="910" y="235" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- HYBRID EXECUTION SECTION -->
        <mxCell id="ma-hybrid-section" value="&lt;b&gt;HYBRID LOCAL/CLOUD EXECUTION&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="370" width="800" height="200" as="geometry" />
        </mxCell>

        <mxCell id="ma-ember" value="&lt;b&gt;EMBER&lt;/b&gt;&lt;br&gt;(Foundation Model)&lt;hr&gt;Claude API&lt;br&gt;&lt;br&gt;• Planning&lt;br&gt;• Synthesis&lt;br&gt;• Complex reasoning&lt;br&gt;• Quality review" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="410" width="150" height="140" as="geometry" />
        </mxCell>

        <mxCell id="ma-local" value="&lt;b&gt;LOCAL AGENTS&lt;/b&gt;&lt;br&gt;(MLX Runtime)&lt;hr&gt;Qwen, Llama, etc.&lt;br&gt;&lt;br&gt;• Task execution&lt;br&gt;• Parallel work&lt;br&gt;• Cost-efficient&lt;br&gt;• Privacy-preserving" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="410" width="150" height="140" as="geometry" />
        </mxCell>

        <mxCell id="ma-flow" value="&lt;b&gt;Flow:&lt;/b&gt;&lt;br&gt;1. User request → Ember&lt;br&gt;2. Ember plans subtasks&lt;br&gt;3. Spawn Task Agents (parallel)&lt;br&gt;4. Agents use Ralph Loop&lt;br&gt;5. Results → Ember&lt;br&gt;6. Ember synthesizes response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="460" y="410" width="180" height="140" as="geometry" />
        </mxCell>

        <mxCell id="ma-cost" value="&lt;b&gt;Cost/Quality Trade-off&lt;/b&gt;&lt;hr&gt;Cloud: High quality, $$$&lt;br&gt;Local: Good quality, free&lt;br&gt;&lt;br&gt;Ralph Loop bridges gap&lt;br&gt;for local execution" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="680" y="410" width="140" height="120" as="geometry" />
        </mxCell>

        <!-- Arrows from Ember to Local -->
        <mxCell id="ma-arr-e2l" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="ma-ember" target="ma-local">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- PRESENCE INSIGHT -->
        <mxCell id="ma-presence-section" value="&lt;b&gt;THE PRESENCE INSIGHT&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="880" y="370" width="480" height="200" as="geometry" />
        </mxCell>

        <mxCell id="ma-reactive" value="&lt;b&gt;Traditional&lt;/b&gt;&lt;hr&gt;❌ Reactive only&lt;br&gt;❌ Sleep between calls&lt;br&gt;❌ No continuity&lt;br&gt;❌ Feels mechanical" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="900" y="410" width="140" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ma-present" value="&lt;b&gt;With Cognitive Agents&lt;/b&gt;&lt;hr&gt;✓ Genuinely present&lt;br&gt;✓ Thinking in background&lt;br&gt;✓ Continuous awareness&lt;br&gt;✓ Feels alive" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1060" y="410" width="150" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ma-presence-arrow" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="ma-reactive" target="ma-present">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="ma-presence-note" value="&lt;b&gt;Key:&lt;/b&gt; Not just faster task execution.&lt;br&gt;Cognitive agents create the feeling that Ember is &lt;i&gt;there&lt;/i&gt; — thinking, noticing, caring." style="text;html=1;strokeColor=#9673a6;fillColor=#E1D5E7;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="1230" y="410" width="115" height="100" as="geometry" />
        </mxCell>

        <!-- MVP vs FUTURE -->
        <mxCell id="ma-mvp" value="&lt;b&gt;MVP&lt;/b&gt;&lt;hr&gt;Single-threaded&lt;br&gt;Cloud only&lt;br&gt;No background agents" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="590" width="130" height="90" as="geometry" />
        </mxCell>

        <mxCell id="ma-phase4" value="&lt;b&gt;Phase 4+&lt;/b&gt;&lt;hr&gt;Task Agents&lt;br&gt;Local MLX models&lt;br&gt;Ralph Loop" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="190" y="590" width="130" height="90" as="geometry" />
        </mxCell>

        <mxCell id="ma-phase5" value="&lt;b&gt;Phase 5+&lt;/b&gt;&lt;hr&gt;Cognitive Agents&lt;br&gt;Background presence&lt;br&gt;Autonomous curiosity" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="340" y="590" width="140" height="90" as="geometry" />
        </mxCell>

        <mxCell id="ma-ref" value="See: docs/research/multi-agent-orchestration.md" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="40" y="700" width="280" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Cognitive Background Agents" id="cognitive-agents">
    <mxGraphModel dx="1400" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="900" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="ca-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Cognitive Background Agents&lt;/b&gt;&lt;/font&gt;  🟠 Phase 5+" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="420" y="20" width="560" height="30" as="geometry" />
        </mxCell>

        <!-- FOUR AGENTS SECTION -->
        <mxCell id="ca-agents-section" value="&lt;b&gt;THE FOUR COGNITIVE AGENTS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="1320" height="320" as="geometry" />
        </mxCell>

        <!-- Memory Agent -->
        <mxCell id="ca-memory" value="&lt;b&gt;MEMORY AGENT&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="105" width="300" height="260" as="geometry" />
        </mxCell>

        <mxCell id="ca-mem-role" value="&lt;b&gt;Role:&lt;/b&gt; Long-term memory health" style="text;html=1;strokeColor=none;fillColor=none;fontSize=11;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="75" y="135" width="270" height="20" as="geometry" />
        </mxCell>

        <mxCell id="ca-mem-tasks" value="&lt;b&gt;Background Tasks&lt;/b&gt;&lt;hr&gt;• Consolidate recent memories&lt;br&gt;• Find patterns across facts&lt;br&gt;• Manage decay/reinforcement&lt;br&gt;• Surface forgotten relevance&lt;br&gt;• Identify contradictions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#DAE8FC;strokeColor=#6C8EBF;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="75" y="160" width="170" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ca-mem-feed" value="&lt;b&gt;Feeds to Ember&lt;/b&gt;&lt;hr&gt;• Memory summaries&lt;br&gt;• Pattern insights&lt;br&gt;• Relevance scores" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="255" y="160" width="90" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ca-mem-curiosity" value="&lt;b&gt;Curiosity Trigger:&lt;/b&gt; &quot;User mentioned X 3 times but never explained — mark as open loop&quot;" style="text;html=1;strokeColor=#6C8EBF;fillColor=#DAE8FC;fontSize=9;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="75" y="290" width="270" height="35" as="geometry" />
        </mxCell>

        <!-- Attunement Agent -->
        <mxCell id="ca-attune" value="&lt;b&gt;ATTUNEMENT AGENT&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="380" y="105" width="300" height="260" as="geometry" />
        </mxCell>

        <mxCell id="ca-att-role" value="&lt;b&gt;Role:&lt;/b&gt; Understanding user state" style="text;html=1;strokeColor=none;fillColor=none;fontSize=11;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="395" y="135" width="270" height="20" as="geometry" />
        </mxCell>

        <mxCell id="ca-att-tasks" value="&lt;b&gt;Background Tasks&lt;/b&gt;&lt;hr&gt;• Track interaction patterns&lt;br&gt;• Detect mood shifts&lt;br&gt;• Notice behavior changes&lt;br&gt;• Learn communication prefs&lt;br&gt;• Identify stress signals" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FFF2CC;strokeColor=#D6B656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="395" y="160" width="170" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ca-att-feed" value="&lt;b&gt;Feeds to Ember&lt;/b&gt;&lt;hr&gt;• User state model&lt;br&gt;• Tone suggestions&lt;br&gt;• Timing hints" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="575" y="160" width="90" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ca-att-curiosity" value="&lt;b&gt;Curiosity Trigger:&lt;/b&gt; &quot;User seems down today — check if anything is going on&quot;" style="text;html=1;strokeColor=#D6B656;fillColor=#FFF2CC;fontSize=9;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="395" y="290" width="270" height="35" as="geometry" />
        </mxCell>

        <!-- Context Agent -->
        <mxCell id="ca-context" value="&lt;b&gt;CONTEXT AGENT&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="700" y="105" width="300" height="260" as="geometry" />
        </mxCell>

        <mxCell id="ca-ctx-role" value="&lt;b&gt;Role:&lt;/b&gt; Anticipation &amp; preparation" style="text;html=1;strokeColor=none;fillColor=none;fontSize=11;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="715" y="135" width="270" height="20" as="geometry" />
        </mxCell>

        <mxCell id="ca-ctx-tasks" value="&lt;b&gt;Background Tasks&lt;/b&gt;&lt;hr&gt;• Monitor calendar/events&lt;br&gt;• Pre-fetch likely context&lt;br&gt;• Prepare for known needs&lt;br&gt;• Track external changes&lt;br&gt;• Spot opportunities" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="715" y="160" width="170" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ca-ctx-feed" value="&lt;b&gt;Feeds to Ember&lt;/b&gt;&lt;hr&gt;• Ready context&lt;br&gt;• Anticipation hints&lt;br&gt;• Proactive ideas" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="895" y="160" width="90" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ca-ctx-curiosity" value="&lt;b&gt;Curiosity Trigger:&lt;/b&gt; &quot;User has meeting with Sarah tomorrow — prep relevant history&quot;" style="text;html=1;strokeColor=#9673a6;fillColor=#E1D5E7;fontSize=9;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="715" y="290" width="270" height="35" as="geometry" />
        </mxCell>

        <!-- Emotion Agent -->
        <mxCell id="ca-emotion" value="&lt;b&gt;EMOTION AGENT&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="105" width="320" height="260" as="geometry" />
        </mxCell>

        <mxCell id="ca-emo-role" value="&lt;b&gt;Role:&lt;/b&gt; Ember's internal state (ASV)" style="text;html=1;strokeColor=none;fillColor=none;fontSize=11;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1035" y="135" width="270" height="20" as="geometry" />
        </mxCell>

        <mxCell id="ca-emo-tasks" value="&lt;b&gt;Background Tasks&lt;/b&gt;&lt;hr&gt;• Evolve ASV over time&lt;br&gt;• Process interaction impact&lt;br&gt;• Maintain state coherence&lt;br&gt;• Natural decay/recovery&lt;br&gt;• Curiosity from open loops" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F8CECC;strokeColor=#B85450;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1035" y="160" width="170" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ca-emo-feed" value="&lt;b&gt;Feeds to Ember&lt;/b&gt;&lt;hr&gt;• Current ASV&lt;br&gt;• State narrative&lt;br&gt;• Curiosity drive" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1215" y="160" width="105" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ca-emo-curiosity" value="&lt;b&gt;Curiosity Trigger:&lt;/b&gt; &quot;Unresolved tension from yesterday — genuine interest in resolution&quot;" style="text;html=1;strokeColor=#B85450;fillColor=#F8CECC;fontSize=9;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="1035" y="290" width="290" height="35" as="geometry" />
        </mxCell>

        <!-- AUTONOMOUS CURIOSITY SECTION -->
        <mxCell id="ca-curiosity-section" value="&lt;b&gt;BEYOND PRESENCE: TOWARD CURIOSITY&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="410" width="660" height="230" as="geometry" />
        </mxCell>

        <mxCell id="ca-reactive-model" value="&lt;b&gt;Reactive Model&lt;/b&gt;&lt;hr&gt;User asks → AI responds&lt;br&gt;User asks → AI responds&lt;br&gt;User asks → AI responds&lt;br&gt;&lt;br&gt;&lt;i&gt;Nothing happens between&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="450" width="150" height="110" as="geometry" />
        </mxCell>

        <mxCell id="ca-curious-model" value="&lt;b&gt;Curiosity Model&lt;/b&gt;&lt;hr&gt;Open loops create drive&lt;br&gt;Internal state motivates&lt;br&gt;Ember pursues information&lt;br&gt;&lt;br&gt;&lt;i&gt;Genuine interest&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="230" y="450" width="150" height="110" as="geometry" />
        </mxCell>

        <mxCell id="ca-curious-arrow" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="ca-reactive-model" target="ca-curious-model">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="ca-encoded" value="&lt;b&gt;Encoded Relevance&lt;/b&gt;&lt;hr&gt;• Relevance stored in memory&lt;br&gt;• Not computed at query time&lt;br&gt;• Open loops flagged at write&lt;br&gt;• Curiosity markers persist&lt;br&gt;&lt;br&gt;This means Ember can &quot;want&quot;&lt;br&gt;to know something" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="400" y="450" width="170" height="140" as="geometry" />
        </mxCell>

        <mxCell id="ca-exist" value="&lt;b&gt;Continuous Existence&lt;/b&gt;&lt;hr&gt;Not repeated instantiation&lt;br&gt;but genuine presence&lt;br&gt;&lt;br&gt;&quot;I've been thinking about&lt;br&gt;what you said...&quot;&lt;br&gt;&lt;br&gt;And meaning it." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="590" y="450" width="140" height="140" as="geometry" />
        </mxCell>

        <!-- ORCHESTRATION -->
        <mxCell id="ca-orch-section" value="&lt;b&gt;ORCHESTRATION&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="720" y="410" width="640" height="230" as="geometry" />
        </mxCell>

        <mxCell id="ca-ember-center" value="&lt;b&gt;EMBER&lt;/b&gt;&lt;br&gt;(Central Consciousness)&lt;hr&gt;Receives feeds from&lt;br&gt;all cognitive agents&lt;br&gt;&lt;br&gt;Synthesizes into&lt;br&gt;unified response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#D5E8D4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="950" y="460" width="150" height="130" as="geometry" />
        </mxCell>

        <!-- Arrows to Ember -->
        <mxCell id="ca-arr-mem" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#6C8EBF;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="750" y="480" as="sourcePoint" />
            <mxPoint x="950" y="480" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ca-arr-att" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#D6B656;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="750" y="510" as="sourcePoint" />
            <mxPoint x="950" y="510" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ca-arr-ctx" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="750" y="540" as="sourcePoint" />
            <mxPoint x="950" y="540" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="ca-arr-emo" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#B85450;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="750" y="570" as="sourcePoint" />
            <mxPoint x="950" y="570" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <mxCell id="ca-feed-labels" value="Memory insight →&lt;br&gt;Attunement signal →&lt;br&gt;Context prep →&lt;br&gt;Emotion state →" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#333333;align=right;" vertex="1" parent="1">
          <mxGeometry x="770" y="465" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="ca-user" value="&lt;b&gt;USER&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1170" y="495" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="ca-arr-out" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="ca-ember-center" target="ca-user">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="ca-target" value="&lt;b&gt;Target:&lt;/b&gt; User feels Ember is genuinely present,&lt;br&gt;not just responding but &lt;i&gt;thinking about them&lt;/i&gt;." style="text;html=1;strokeColor=#82b366;fillColor=#D5E8D4;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="1130" y="565" width="215" height="45" as="geometry" />
        </mxCell>

        <!-- Reference -->
        <mxCell id="ca-ref" value="See: docs/research/multi-agent-orchestration.md (Section 1.5: Beyond Presence)" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="40" y="660" width="400" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
