<mxfile host="app.diagrams.net" modified="2026-02-03T00:00:00.000Z" agent="EmberHearth Architecture" version="22.0.0" type="device">
  <diagram name="System Overview" id="system-overview">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- LEGEND -->
        <mxCell id="legend-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#F5F5F5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="20" y="20" width="200" height="120" as="geometry" />
        </mxCell>
        <mxCell id="legend-title" value="&lt;b&gt;LEGEND&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="80" y="25" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-mvp" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="30" y="50" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-mvp-text" value="MVP (Phase 2-3)" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="50" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-full" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="30" y="75" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-full-text" value="Full System" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="75" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-ext" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="30" y="100" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-ext-text" value="External" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="55" y="100" width="100" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-future" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="130" y="50" width="20" height="20" as="geometry" />
        </mxCell>
        <mxCell id="legend-future-text" value="Future" style="text;html=1;strokeColor=none;fillColor=none;align=left;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="155" y="50" width="60" height="20" as="geometry" />
        </mxCell>

        <!-- TITLE -->
        <mxCell id="title" value="&lt;font style=&quot;font-size: 24px;&quot;&gt;&lt;b&gt;EmberHearth System Architecture&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="20" width="400" height="40" as="geometry" />
        </mxCell>

        <!-- USER TOUCHPOINTS SECTION -->
        <mxCell id="user-section" value="&lt;b&gt;USER TOUCHPOINTS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="80" width="960" height="140" as="geometry" />
        </mxCell>

        <!-- iMessage - MVP -->
        <mxCell id="imessage" value="&lt;b&gt;iMessage&lt;/b&gt;&lt;br&gt;(Primary Interface)&lt;br&gt;&lt;br&gt;Personal: +1-555-XXX&lt;br&gt;Work: +1-555-YYY" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="115" width="160" height="90" as="geometry" />
        </mxCell>

        <!-- MacOS App - MVP -->
        <mxCell id="macos-app" value="&lt;b&gt;MacOS App&lt;/b&gt;&lt;br&gt;(Admin Interface)&lt;br&gt;&lt;br&gt;Onboarding, Settings&lt;br&gt;Data Browser" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="450" y="115" width="160" height="90" as="geometry" />
        </mxCell>

        <!-- Group Chat - Full -->
        <mxCell id="group-chat" value="&lt;b&gt;Group Chat&lt;/b&gt;&lt;br&gt;(Social Mode)&lt;br&gt;&lt;br&gt;No tools/memory&lt;br&gt;Natural timing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="640" y="115" width="160" height="90" as="geometry" />
        </mxCell>

        <!-- Web UI - Future -->
        <mxCell id="web-ui" value="&lt;b&gt;Web UI&lt;/b&gt;&lt;br&gt;(Future)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="830" y="115" width="110" height="90" as="geometry" />
        </mxCell>

        <!-- Voice - Future -->
        <mxCell id="voice" value="&lt;b&gt;Voice&lt;/b&gt;&lt;br&gt;(Future)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="970" y="115" width="110" height="90" as="geometry" />
        </mxCell>

        <!-- DEFENSE LAYERS SECTION -->
        <mxCell id="defense-section" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="240" y="240" width="960" height="100" as="geometry" />
        </mxCell>
        <mxCell id="input-gateway" value="&lt;b&gt;Input Gateway&lt;/b&gt;&lt;br&gt;Rate limit, Validate" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="255" width="150" height="70" as="geometry" />
        </mxCell>
        <mxCell id="tron" value="&lt;b&gt;TRON&lt;/b&gt;&lt;br&gt;Prompt injection | Tool auth | Anomaly" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="255" width="220" height="70" as="geometry" />
        </mxCell>
        <mxCell id="output-validation" value="&lt;b&gt;Output Validation&lt;/b&gt;&lt;br&gt;Secret detect, PII redact" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="670" y="255" width="170" height="70" as="geometry" />
        </mxCell>
        <mxCell id="workbench" value="&lt;b&gt;Workbench&lt;/b&gt;&lt;br&gt;Isolated container" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="860" y="255" width="140" height="70" as="geometry" />
        </mxCell>
        <mxCell id="defense-note" value="See: Security Layers drill-down" style="text;html=1;strokeColor=none;fillColor=none;fontStyle=2;fontSize=9;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1010" y="290" width="140" height="20" as="geometry" />
        </mxCell>

        <!-- CORE SECTION -->
        <mxCell id="core-section" value="&lt;b&gt;EMBERHEARTH CORE&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="360" width="960" height="310" as="geometry" />
        </mxCell>

        <!-- Main App - MVP -->
        <mxCell id="main-app" value="&lt;b&gt;EmberHearth.app&lt;/b&gt;&lt;br&gt;(Main Process)&lt;br&gt;&lt;hr&gt;SwiftUI UI&lt;br&gt;XPC Coordinator&lt;br&gt;Permission Manager" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="520" y="390" width="180" height="110" as="geometry" />
        </mxCell>

        <!-- XPC Services with Sandbox Boundary -->
        <mxCell id="sandbox-boundary" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#B85450;strokeWidth=2;dashed=1;dashPattern=8 4;" vertex="1" parent="1">
          <mxGeometry x="255" y="515" width="750" height="150" as="geometry" />
        </mxCell>
        <mxCell id="sandbox-label" value="&lt;b&gt;APP SANDBOX BOUNDARY&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontStyle=0;align=left;fontColor=#B85450;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="265" y="518" width="180" height="15" as="geometry" />
        </mxCell>
        <mxCell id="xpc-label" value="XPC Services (Isolated Processes)" style="text;html=1;strokeColor=none;fillColor=none;fontStyle=1;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="530" y="515" width="200" height="20" as="geometry" />
        </mxCell>

        <!-- MessageService - MVP -->
        <mxCell id="msg-service" value="&lt;b&gt;MessageService.xpc&lt;/b&gt;&lt;hr&gt;MessageReader (SQLite)&lt;br&gt;MessageSender (AppleScript)&lt;br&gt;MessageRouter&lt;br&gt;GroupChatDetector" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="270" y="540" width="200" height="110" as="geometry" />
        </mxCell>

        <!-- MemoryService - Mixed -->
        <mxCell id="mem-service" value="&lt;b&gt;MemoryService.xpc&lt;/b&gt;&lt;hr&gt;MemoryDatabase&lt;br&gt;ConversationArchive&lt;br&gt;SessionState&lt;br&gt;Summarizer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="510" y="540" width="200" height="110" as="geometry" />
        </mxCell>
        <mxCell id="mem-service-full" value="Embeddings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="625" width="90" height="25" as="geometry" />
        </mxCell>

        <!-- LLMService - Mixed -->
        <mxCell id="llm-service" value="&lt;b&gt;LLMService.xpc&lt;/b&gt;&lt;hr&gt;CloudProvider&lt;br&gt;ContextBuilder&lt;br&gt;PolicyEnforcer&lt;br&gt;&lt;b&gt;AdaptiveRouter&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="750" y="540" width="200" height="110" as="geometry" />
        </mxCell>
        <mxCell id="llm-local" value="LocalProvider (MLX)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="760" y="625" width="130" height="25" as="geometry" />
        </mxCell>
        <mxCell id="llm-note" value="See: LLM Orchestration drill-down" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="760" y="650" width="160" height="15" as="geometry" />
        </mxCell>

        <!-- Ember Personality -->
        <mxCell id="ember" value="&lt;b&gt;EMBER&lt;/b&gt;&lt;br&gt;(Personality)&lt;hr&gt;System Prompt&lt;br&gt;Voice &amp; Tone&lt;br&gt;Emotional Encoding" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="390" width="160" height="110" as="geometry" />
        </mxCell>

        <!-- Plugin System - Future -->
        <mxCell id="plugin-system" value="&lt;b&gt;Plugin System&lt;/b&gt;&lt;hr&gt;Plugin Manager&lt;br&gt;JS Runtime (Sandbox)&lt;br&gt;EmberHearth API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="530" width="160" height="105" as="geometry" />
        </mxCell>
        <mxCell id="plugin-note" value="See: Plugin drill-down" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="635" width="120" height="15" as="geometry" />
        </mxCell>

        <!-- XPC Connections -->
        <mxCell id="xpc1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;endArrow=none;endFill=0;" edge="1" parent="1" source="main-app" target="msg-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xpc2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;endArrow=none;endFill=0;" edge="1" parent="1" source="main-app" target="mem-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="xpc3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;endArrow=none;endFill=0;" edge="1" parent="1" source="main-app" target="llm-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- EXTERNAL SECTION -->
        <mxCell id="ext-section" value="&lt;b&gt;EXTERNAL DEPENDENCIES&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="690" width="960" height="190" as="geometry" />
        </mxCell>

        <!-- iMessage Backend -->
        <mxCell id="chat-db" value="&lt;b&gt;iMessage&lt;/b&gt;&lt;hr&gt;~/Library/Messages/chat.db&lt;br&gt;Messages.app (AppleScript)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="725" width="200" height="90" as="geometry" />
        </mxCell>

        <!-- Data Stores -->
        <mxCell id="data-stores" value="&lt;b&gt;Data Stores&lt;/b&gt;&lt;hr&gt;personal/memory.db&lt;br&gt;personal/archive.db&lt;br&gt;work/memory.db&lt;br&gt;work/audit.log" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="725" width="170" height="110" as="geometry" />
        </mxCell>
        <mxCell id="data-path" value="~/Library/Application Support/EmberHearth/" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="840" width="200" height="15" as="geometry" />
        </mxCell>

        <!-- LLM APIs -->
        <mxCell id="llm-apis" value="&lt;b&gt;LLM APIs&lt;/b&gt;&lt;hr&gt;Claude (Anthropic) ✓&lt;br&gt;OpenAI&lt;br&gt;Local (MLX)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="690" y="725" width="150" height="90" as="geometry" />
        </mxCell>

        <!-- Apple Frameworks + Integration Services -->
        <mxCell id="apple-fw" value="&lt;b&gt;Apple Frameworks&lt;/b&gt;&lt;hr&gt;EventKit (Calendar)&lt;br&gt;Contacts&lt;br&gt;MapKit, HomeKit..." style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="870" y="725" width="170" height="90" as="geometry" />
        </mxCell>
        <mxCell id="integration-services" value="&lt;b&gt;Integration XPCs&lt;/b&gt;&lt;br&gt;CalendarService, MailService, NotesService" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontSize=10;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="870" y="820" width="170" height="50" as="geometry" />
        </mxCell>
        <mxCell id="int-note" value="See: Integrations drill-down" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="870" y="870" width="150" height="15" as="geometry" />
        </mxCell>

        <!-- Security -->
        <mxCell id="security" value="&lt;b&gt;Security&lt;/b&gt;&lt;hr&gt;Keychain (API keys)&lt;br&gt;Secure Enclave (DB keys)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1060" y="725" width="170" height="90" as="geometry" />
        </mxCell>

        <!-- Ember to LLM Connection -->
        <mxCell id="ember-llm" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#9673a6;strokeWidth=2;endArrow=classic;endFill=1;dashed=1;" edge="1" parent="1" source="ember" target="llm-service">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ember-label" value="System prompt" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="960" y="510" width="80" height="15" as="geometry" />
        </mxCell>

        <!-- Connections -->
        <mxCell id="conn1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="imessage" target="input-gateway">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;endFill=1;" edge="1" parent="1" source="output-validation" target="main-app">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=1;endArrow=classic;endFill=1;" edge="1" parent="1" source="msg-service" target="chat-db">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=1;endArrow=classic;endFill=1;" edge="1" parent="1" source="mem-service" target="data-stores">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="conn5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeColor=#666666;strokeWidth=1;endArrow=classic;endFill=1;" edge="1" parent="1" source="llm-service" target="llm-apis">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Data Flow - Message Processing" id="data-flow">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="df-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Data Flow: Incoming Message Processing&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="400" height="30" as="geometry" />
        </mxCell>

        <!-- Step 1: iMessage -->
        <mxCell id="df-step1" value="&lt;b&gt;1. New Message&lt;/b&gt;&lt;br&gt;&lt;br&gt;FSEvents detects&lt;br&gt;change in chat.db" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Step 2: MessageService -->
        <mxCell id="df-step2" value="&lt;b&gt;2. MessageService&lt;/b&gt;&lt;br&gt;&lt;br&gt;Read message&lt;br&gt;Detect context&lt;br&gt;Check if group" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Step 3: Tron -->
        <mxCell id="df-step3" value="&lt;b&gt;3. Tron&lt;/b&gt;&lt;br&gt;&lt;br&gt;Security check&lt;br&gt;Group? → Social only&lt;br&gt;Authorize tools" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="360" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Step 4: MemoryService -->
        <mxCell id="df-step4" value="&lt;b&gt;4. MemoryService&lt;/b&gt;&lt;br&gt;&lt;br&gt;Retrieve session&lt;br&gt;Get memories&lt;br&gt;Get archive chunks" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="520" y="100" width="130" height="80" as="geometry" />
        </mxCell>

        <!-- Step 5: Context Builder -->
        <mxCell id="df-step5" value="&lt;b&gt;5. Build Context&lt;/b&gt;&lt;br&gt;&lt;br&gt;10% system prompt&lt;br&gt;25% recent msgs&lt;br&gt;15% memories&lt;br&gt;10% summary" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="690" y="100" width="130" height="80" as="geometry" />
        </mxCell>

        <!-- Step 6: LLM -->
        <mxCell id="df-step6" value="&lt;b&gt;6. LLMService&lt;/b&gt;&lt;br&gt;&lt;br&gt;Send to Claude API&lt;br&gt;Stream response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="860" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Step 7: External LLM -->
        <mxCell id="df-step7" value="&lt;b&gt;7. LLM API&lt;/b&gt;&lt;br&gt;&lt;br&gt;Process request&lt;br&gt;Generate response" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="1020" y="100" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Return flow -->
        <mxCell id="df-step8" value="&lt;b&gt;8. Send Response&lt;/b&gt;&lt;br&gt;&lt;br&gt;AppleScript to&lt;br&gt;Messages.app" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="250" width="120" height="80" as="geometry" />
        </mxCell>

        <!-- Async memory extraction -->
        <mxCell id="df-step9" value="&lt;b&gt;9. Async: Memory&lt;/b&gt;&lt;br&gt;&lt;br&gt;Extract facts&lt;br&gt;Update archive&lt;br&gt;Update session" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="520" y="250" width="130" height="80" as="geometry" />
        </mxCell>

        <!-- Arrows -->
        <mxCell id="df-a1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step1" target="df-step2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step2" target="df-step3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step3" target="df-step4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step4" target="df-step5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step5" target="df-step6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="df-step6" target="df-step7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="df-a7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;dashed=1;" edge="1" parent="1" source="df-step7" target="df-step8">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1080" y="210" />
              <mxPoint x="260" y="210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="df-a8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#6c8ebf;strokeWidth=2;endArrow=classic;dashed=1;" edge="1" parent="1" source="df-step6" target="df-step9">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="920" y="200" />
              <mxPoint x="720" y="200" />
              <mxPoint x="720" y="290" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Notes -->
        <mxCell id="df-note1" value="Solid = sync&lt;br&gt;Dashed = async/return" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="350" width="120" height="30" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="MVP Scope" id="mvp-scope">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="600" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="mvp-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;MVP Scope (Phase 2-3)&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="300" height="30" as="geometry" />
        </mxCell>

        <!-- MVP Box -->
        <mxCell id="mvp-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;strokeWidth=3;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="400" height="480" as="geometry" />
        </mxCell>
        <mxCell id="mvp-label" value="&lt;b&gt;MVP SCOPE&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=14;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="50" y="80" width="100" height="25" as="geometry" />
        </mxCell>

        <!-- MVP Items -->
        <mxCell id="mvp-1" value="&lt;b&gt;EmberHearth.app&lt;/b&gt;&lt;br&gt;Basic SwiftUI shell" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="120" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-2" value="&lt;b&gt;Onboarding&lt;/b&gt;&lt;br&gt;Permissions, LLM setup" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="120" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-3" value="&lt;b&gt;MessageService&lt;/b&gt;&lt;br&gt;Read/write iMessage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="190" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-4" value="&lt;b&gt;Personal Context Only&lt;/b&gt;&lt;br&gt;Single phone number" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="190" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-5" value="&lt;b&gt;MemoryService&lt;/b&gt;&lt;br&gt;Basic fact storage" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="260" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-6" value="&lt;b&gt;Session State&lt;/b&gt;&lt;br&gt;Recent messages cache" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="260" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-7" value="&lt;b&gt;LLMService&lt;/b&gt;&lt;br&gt;Claude API only" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="330" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-8" value="&lt;b&gt;Context Building&lt;/b&gt;&lt;br&gt;Basic budget allocation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="330" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-9" value="&lt;b&gt;Tron (Hardcoded)&lt;/b&gt;&lt;br&gt;Basic rules only" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="400" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-10" value="&lt;b&gt;Group Chat&lt;/b&gt;&lt;br&gt;Detect and block" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="240" y="400" width="160" height="50" as="geometry" />
        </mxCell>
        <mxCell id="mvp-11" value="&lt;b&gt;Identity&lt;/b&gt;&lt;br&gt;Passkey confirmation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="150" y="470" width="160" height="50" as="geometry" />
        </mxCell>

        <!-- Later Box -->
        <mxCell id="later-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;strokeWidth=3;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="480" y="70" width="240" height="320" as="geometry" />
        </mxCell>
        <mxCell id="later-label" value="&lt;b&gt;FULL SYSTEM (Phase 4+)&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=14;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="80" width="180" height="25" as="geometry" />
        </mxCell>

        <!-- Later Items -->
        <mxCell id="later-1" value="Work context" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="120" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-2" value="Embeddings" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="120" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-3" value="Conv. Archive" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="165" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-4" value="Local models" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="165" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-5" value="Full Tron" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="210" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-6" value="Group social" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="210" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-7" value="Apple integrations" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="255" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-8" value="Data browser" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="255" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-9" value="OpenAI provider" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="300" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="later-10" value="Audit logging" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="300" width="100" height="35" as="geometry" />
        </mxCell>

        <!-- Future Box -->
        <mxCell id="future-box" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;strokeWidth=3;opacity=30;" vertex="1" parent="1">
          <mxGeometry x="480" y="410" width="240" height="140" as="geometry" />
        </mxCell>
        <mxCell id="future-label" value="&lt;b&gt;FUTURE / EARMARKED&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=14;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="420" width="180" height="25" as="geometry" />
        </mxCell>

        <!-- Future Items -->
        <mxCell id="future-1" value="Multi-user roles" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="455" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="future-2" value="Family groups" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="455" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="future-3" value="Web UI" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="500" width="100" height="35" as="geometry" />
        </mxCell>
        <mxCell id="future-4" value="Voice interface" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="610" y="500" width="100" height="35" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Plugin System" id="plugin-system-detail">
    <mxGraphModel dx="1100" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <mxCell id="ps-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Plugin System Architecture&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="300" height="30" as="geometry" />
        </mxCell>

        <mxCell id="ps-manager" value="&lt;b&gt;Plugin Manager&lt;/b&gt;&lt;hr&gt;Load manifests&lt;br&gt;Register tools with LLM&lt;br&gt;Route tool calls&lt;br&gt;Enforce permissions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="80" width="200" height="120" as="geometry" />
        </mxCell>

        <!-- Sandbox Boundary for Plugin Runtime -->
        <mxCell id="ps-sandbox-boundary" value="" style="rounded=1;whiteSpace=wrap;html=1;fillColor=none;strokeColor=#B85450;strokeWidth=2;dashed=1;dashPattern=8 4;" vertex="1" parent="1">
          <mxGeometry x="50" y="230" width="240" height="310" as="geometry" />
        </mxCell>
        <mxCell id="ps-sandbox-label" value="&lt;b&gt;JAVASCRIPTCORE SANDBOX&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontStyle=0;align=center;fontColor=#B85450;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="60" y="235" width="220" height="18" as="geometry" />
        </mxCell>
        <mxCell id="ps-runtime" value="&lt;b&gt;Plugin Runtime&lt;/b&gt;&lt;hr&gt;JavaScriptCore Engine&lt;br&gt;No filesystem access&lt;br&gt;Declared network only&lt;br&gt;Execution timeout" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="70" y="265" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ps-api" value="&lt;b&gt;EmberHearth API&lt;/b&gt;&lt;hr&gt;calendar.listEvents()&lt;br&gt;contacts.search()&lt;br&gt;memory.query()&lt;br&gt;notifications.send()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="250" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ps-registry" value="&lt;b&gt;Tool Registry&lt;/b&gt;&lt;hr&gt;Map plugin tools&lt;br&gt;to EmberHearth APIs" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="730" y="250" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ps-moltbot" value="&lt;b&gt;Moltbot Compat&lt;/b&gt;&lt;hr&gt;Import AgentSkills&lt;br&gt;Security adaptation" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="730" y="380" width="180" height="100" as="geometry" />
        </mxCell>

        <mxCell id="ps-perms" value="&lt;b&gt;Permission System&lt;/b&gt;&lt;hr&gt;network: [domains]&lt;br&gt;secrets: [names]&lt;br&gt;storage: quota&lt;br&gt;apis: [allowed]" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="70" y="405" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ps-manifest" value="&lt;b&gt;Plugin Manifest&lt;/b&gt;&lt;hr&gt;name, version&lt;br&gt;tools: [definitions]&lt;br&gt;permissions: [required]&lt;br&gt;entry: main.js" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="410" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="ps-a1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="ps-manager" target="ps-runtime">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ps-a2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="ps-manager" target="ps-api">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="ps-a3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="ps-manager" target="ps-registry">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="ps-note" value="Phase: Future (v2+)&lt;br&gt;MCP-style tool registration" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="50" y="570" width="180" height="30" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="LLM Orchestration" id="llm-orchestration">
    <mxGraphModel dx="1200" dy="850" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="850" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <mxCell id="llm-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;LLM Orchestration &amp;amp; Routing&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="430" y="20" width="340" height="30" as="geometry" />
        </mxCell>

        <mxCell id="llm-modes-box" value="&lt;b&gt;Four LLM Modes&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="600" height="140" as="geometry" />
        </mxCell>
        <mxCell id="llm-mode1" value="&lt;b&gt;Cloud Only&lt;/b&gt;&lt;br&gt;(Default/MVP)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="105" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="llm-mode2" value="&lt;b&gt;Local Only&lt;/b&gt;&lt;br&gt;(Privacy)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="105" width="120" height="80" as="geometry" />
        </mxCell>
        <mxCell id="llm-mode3" value="&lt;b&gt;Simple Hybrid&lt;/b&gt;&lt;br&gt;(Auto-route)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="340" y="105" width="130" height="80" as="geometry" />
        </mxCell>
        <mxCell id="llm-mode4" value="&lt;b&gt;Orchestrated&lt;/b&gt;&lt;br&gt;(Recommended)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="490" y="105" width="130" height="80" as="geometry" />
        </mxCell>

        <mxCell id="llm-router" value="&lt;b&gt;Adaptive Router&lt;/b&gt;&lt;hr&gt;Query complexity&lt;br&gt;Context policy&lt;br&gt;Performance history&lt;br&gt;Quality signals" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="680" y="85" width="180" height="120" as="geometry" />
        </mxCell>

        <mxCell id="llm-orch-box" value="&lt;b&gt;Orchestrated Hybrid Detail&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="240" width="820" height="230" as="geometry" />
        </mxCell>
        <mxCell id="llm-cloud-orch" value="&lt;b&gt;Cloud Orchestrator&lt;/b&gt;&lt;br&gt;(Claude/GPT-4)&lt;hr&gt;Understand intent&lt;br&gt;Plan subtasks&lt;br&gt;Synthesize response&lt;br&gt;Quality review" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="330" y="275" width="180" height="140" as="geometry" />
        </mxCell>
        <mxCell id="llm-local-cal" value="&lt;b&gt;Calendar Agent&lt;/b&gt;&lt;br&gt;(Local Qwen)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="70" y="380" width="130" height="65" as="geometry" />
        </mxCell>
        <mxCell id="llm-local-mail" value="&lt;b&gt;Email Agent&lt;/b&gt;&lt;br&gt;(Local Qwen)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="550" y="380" width="130" height="65" as="geometry" />
        </mxCell>
        <mxCell id="llm-local-draft" value="&lt;b&gt;Draft Agent&lt;/b&gt;&lt;br&gt;(Local Qwen)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="700" y="380" width="130" height="65" as="geometry" />
        </mxCell>

        <mxCell id="llm-self-tune" value="&lt;b&gt;Self-Tuning Engine&lt;/b&gt;&lt;hr&gt;Performance signals&lt;br&gt;Quality signals&lt;br&gt;Graceful degradation&lt;br&gt;User notifications" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="900" y="240" width="180" height="130" as="geometry" />
        </mxCell>

        <mxCell id="llm-monitor" value="&lt;b&gt;Monitoring Dashboard&lt;/b&gt;&lt;hr&gt;Token usage&lt;br&gt;Cost tracking&lt;br&gt;A/B testing" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="900" y="390" width="180" height="110" as="geometry" />
        </mxCell>

        <mxCell id="llm-a1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="llm-cloud-orch" target="llm-local-cal">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="llm-a2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="llm-cloud-orch" target="llm-local-mail">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="llm-a3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="llm-cloud-orch" target="llm-local-draft">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-privacy-note" value="&lt;b&gt;Privacy:&lt;/b&gt; Sensitive data stays local.&lt;br&gt;Only structured summaries go to cloud." style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="500" width="250" height="50" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Security Layers" id="security-layers">
    <mxGraphModel dx="1100" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1100" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <mxCell id="sec-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Defense in Depth - Security Layers&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="350" y="20" width="400" height="30" as="geometry" />
        </mxCell>

        <mxCell id="sec-l1" value="&lt;b&gt;Layer 1: Input Gateway&lt;/b&gt;&lt;hr&gt;Rate limiting&lt;br&gt;Format validation&lt;br&gt;Known attack patterns" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l2" value="&lt;b&gt;Layer 2: Tron Firewall&lt;/b&gt;&lt;hr&gt;Signature-based detection&lt;br&gt;ML classification&lt;br&gt;Structural analysis" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="270" y="80" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l3" value="&lt;b&gt;Layer 3: Capability Bounds&lt;/b&gt;&lt;hr&gt;Structured ops only&lt;br&gt;Sandboxed file access&lt;br&gt;Credential use not expose" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="80" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l4" value="&lt;b&gt;Layer 4: Workbench&lt;/b&gt;&lt;hr&gt;Docker/gVisor container&lt;br&gt;No ambient authority&lt;br&gt;Explicit data transfer" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="730" y="80" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l5" value="&lt;b&gt;Layer 5: Output Validation&lt;/b&gt;&lt;hr&gt;Secret detection&lt;br&gt;PII redaction&lt;br&gt;Behavior anomaly" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="270" y="220" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-l6" value="&lt;b&gt;Layer 6: Retrospective&lt;/b&gt;&lt;hr&gt;Continuous history scan&lt;br&gt;Incident correlation&lt;br&gt;Signature feedback" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="500" y="220" width="200" height="110" as="geometry" />
        </mxCell>

        <mxCell id="sec-tron-detail" value="&lt;b&gt;Tron Responsibilities&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="370" width="470" height="180" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-1" value="Prompt injection firewall" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="410" width="180" height="45" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-2" value="Tool call authorization" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="410" width="180" height="45" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-3" value="Group chat restrictions" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="470" width="180" height="45" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-4" value="Anomaly detection" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="470" width="180" height="45" as="geometry" />
        </mxCell>
        <mxCell id="sec-tron-5" value="Audit logging" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="160" y="525" width="180" height="40" as="geometry" />
        </mxCell>

        <mxCell id="sec-keychain" value="&lt;b&gt;Keychain Integration&lt;/b&gt;&lt;hr&gt;API keys per context&lt;br&gt;Secure Enclave for DB keys&lt;br&gt;Credentials used not exposed" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="540" y="370" width="200" height="120" as="geometry" />
        </mxCell>

        <mxCell id="sec-sandbox" value="&lt;b&gt;App Sandbox&lt;/b&gt;&lt;hr&gt;Container isolation&lt;br&gt;Entitlements&lt;br&gt;Hardened Runtime" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="770" y="370" width="180" height="120" as="geometry" />
        </mxCell>

        <mxCell id="sec-mvp-note" value="MVP: Layers 1, 3 only (hardcoded rules)" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=2;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="580" width="220" height="20" as="geometry" />
        </mxCell>

        <!-- Flow Arrows: Data Pipeline -->
        <mxCell id="sec-flow-input" value="&lt;b&gt;Input&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#82b366;align=right;" vertex="1" parent="1">
          <mxGeometry x="-20" y="125" width="50" height="20" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="30" y="135" as="sourcePoint" />
            <mxPoint x="40" y="135" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sec-arr-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l1" target="sec-l2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l2" target="sec-l3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l3" target="sec-l4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l4" target="sec-l5">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="960" y="135" />
              <mxPoint x="960" y="275" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sec-arr-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="sec-l5" target="sec-l6">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="sec-arr-out" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="700" y="275" as="sourcePoint" />
            <mxPoint x="1000" y="275" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="sec-flow-output" value="&lt;b&gt;Output&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="1005" y="265" width="50" height="20" as="geometry" />
        </mxCell>
        <!-- Retrospective feedback loop -->
        <mxCell id="sec-arr-retro" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#6c8ebf;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1" source="sec-l6" target="sec-l2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="600" y="350" />
              <mxPoint x="370" y="350" />
              <mxPoint x="370" y="200" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="sec-retro-label" value="Signature feedback" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="400" y="340" width="120" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Integration Services" id="integration-services">
    <mxGraphModel dx="1200" dy="800" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="800" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <mxCell id="int-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Apple Integration Services&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="450" y="20" width="300" height="30" as="geometry" />
        </mxCell>

        <mxCell id="int-tier1" value="&lt;b&gt;Tier 1: Core Integrations&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;opacity=50;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="540" height="160" as="geometry" />
        </mxCell>
        <mxCell id="int-calendar" value="&lt;b&gt;CalendarService.xpc&lt;/b&gt;&lt;hr&gt;EventKit&lt;br&gt;List/Create events&lt;br&gt;Reminders" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="110" width="155" height="100" as="geometry" />
        </mxCell>
        <mxCell id="int-mail" value="&lt;b&gt;MailService.xpc&lt;/b&gt;&lt;hr&gt;Mail.app AppleScript&lt;br&gt;List/Send" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="235" y="110" width="155" height="100" as="geometry" />
        </mxCell>
        <mxCell id="int-contacts" value="&lt;b&gt;ContactsService.xpc&lt;/b&gt;&lt;hr&gt;Contacts framework&lt;br&gt;Search/Lookup" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="410" y="110" width="155" height="100" as="geometry" />
        </mxCell>

        <mxCell id="int-tier2" value="&lt;b&gt;Tier 2: Enhanced Integrations&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;opacity=50;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="260" width="700" height="160" as="geometry" />
        </mxCell>
        <mxCell id="int-notes" value="&lt;b&gt;NotesService&lt;/b&gt;&lt;hr&gt;Notes AppleScript" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="300" width="125" height="90" as="geometry" />
        </mxCell>
        <mxCell id="int-weather" value="&lt;b&gt;WeatherService&lt;/b&gt;&lt;hr&gt;WeatherKit" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="200" y="300" width="125" height="90" as="geometry" />
        </mxCell>
        <mxCell id="int-maps" value="&lt;b&gt;MapsService&lt;/b&gt;&lt;hr&gt;MapKit" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="340" y="300" width="125" height="90" as="geometry" />
        </mxCell>
        <mxCell id="int-homekit" value="&lt;b&gt;HomeService&lt;/b&gt;&lt;hr&gt;HomeKit" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="480" y="300" width="125" height="90" as="geometry" />
        </mxCell>
        <mxCell id="int-shortcuts" value="&lt;b&gt;ShortcutsService&lt;/b&gt;&lt;hr&gt;Shortcuts API" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="620" y="300" width="105" height="90" as="geometry" />
        </mxCell>

        <mxCell id="int-protocol" value="&lt;b&gt;ContextAwareIntegration Protocol&lt;/b&gt;&lt;hr&gt;All services implement:&lt;br&gt;- detectContext() → .personal | .work&lt;br&gt;- routeToContext(context)&lt;br&gt;- getAccountsForContext(context)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="790" y="100" width="250" height="130" as="geometry" />
        </mxCell>

        <mxCell id="int-intent" value="&lt;b&gt;IntentRouter&lt;/b&gt;&lt;hr&gt;Classify user intent&lt;br&gt;Route to service&lt;br&gt;Enforce capability bounds" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="790" y="270" width="250" height="110" as="geometry" />
        </mxCell>

        <mxCell id="int-phases" value="&lt;b&gt;Implementation Phases&lt;/b&gt;&lt;br&gt;&lt;br&gt;MVP: No integrations&lt;br&gt;Phase 4: Tier 1 (Calendar, Mail, Contacts)&lt;br&gt;Phase 5+: Tier 2 (Notes, Weather, Maps, etc.)" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="40" y="450" width="280" height="100" as="geometry" />
        </mxCell>

        <!-- Flow: User Intent → IntentRouter → Services -->
        <mxCell id="int-input" value="&lt;b&gt;User Intent&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#82b366;align=right;" vertex="1" parent="1">
          <mxGeometry x="690" y="305" width="80" height="20" as="geometry" />
        </mxCell>
        <mxCell id="int-arr-in" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="775" y="325" as="sourcePoint" />
            <mxPoint x="790" y="325" as="targetPoint" />
          </mxGeometry>
        </mxCell>

        <!-- IntentRouter to Tier 1 services -->
        <mxCell id="int-arr-cal" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="int-intent" target="int-calendar">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="760" y="380" />
              <mxPoint x="760" y="160" />
              <mxPoint x="580" y="160" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="int-arr-mail" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="int-intent" target="int-mail">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="740" y="380" />
              <mxPoint x="740" y="55" />
              <mxPoint x="313" y="55" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="int-arr-contacts" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=1;endArrow=classic;" edge="1" parent="1" source="int-intent" target="int-contacts">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="720" y="380" />
              <mxPoint x="720" y="50" />
              <mxPoint x="138" y="50" />
              <mxPoint x="138" y="160" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- IntentRouter to Tier 2 services -->
        <mxCell id="int-arr-tier2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#6c8ebf;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1" source="int-intent" target="int-notes">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="790" y="410" />
              <mxPoint x="30" y="410" />
              <mxPoint x="30" y="345" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Protocol implements arrows -->
        <mxCell id="int-proto-arr1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=1;endArrow=block;endFill=0;dashed=1;dashPattern=4 2;" edge="1" parent="1" source="int-calendar" target="int-protocol">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="int-proto-label" value="implements" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="640" y="130" width="70" height="15" as="geometry" />
        </mxCell>

        <!-- Output arrow -->
        <mxCell id="int-arr-out" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1040" y="325" as="sourcePoint" />
            <mxPoint x="1100" y="325" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="int-output" value="&lt;b&gt;Response&lt;/b&gt;" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="1105" y="315" width="70" height="20" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>

  <diagram name="Ember Personality System" id="ember-personality">
    <mxGraphModel dx="1200" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- Title -->
        <mxCell id="pers-title" value="&lt;font style=&quot;font-size: 20px;&quot;&gt;&lt;b&gt;Ember Personality System&lt;/b&gt;&lt;/font&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="530" y="20" width="280" height="30" as="geometry" />
        </mxCell>

        <!-- THREE-LAYER MODEL SECTION -->
        <mxCell id="pers-layers-section" value="&lt;b&gt;THREE-LAYER PERSONALITY MODEL&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="70" width="600" height="280" as="geometry" />
        </mxCell>

        <!-- Layer 1: Identity -->
        <mxCell id="pers-identity" value="&lt;b&gt;Layer 1: Identity&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Sex:&lt;/b&gt; Male | Female&lt;br&gt;&lt;b&gt;Name:&lt;/b&gt; Default &quot;Ember&quot;&lt;br&gt;(User-changeable)&lt;br&gt;&lt;br&gt;&lt;i&gt;Static - Set during onboarding&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="110" width="170" height="140" as="geometry" />
        </mxCell>

        <!-- Layer 2: Communication Style -->
        <mxCell id="pers-style" value="&lt;b&gt;Layer 2: Communication Style&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Four-Dial Tone Spectrum:&lt;/b&gt;&lt;br&gt;• Warmth (cool ↔ warm)&lt;br&gt;• Formality (casual ↔ formal)&lt;br&gt;• Verbosity (brief ↔ detailed)&lt;br&gt;• Humor (serious ↔ playful)&lt;br&gt;&lt;br&gt;&lt;i&gt;Configurable baseline, adaptive&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="255" y="110" width="190" height="165" as="geometry" />
        </mxCell>

        <!-- Layer 3: Archetype -->
        <mxCell id="pers-archetype" value="&lt;b&gt;Layer 3: Archetype&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Presets:&lt;/b&gt;&lt;br&gt;• Ember (warm, nurturing)&lt;br&gt;• Ash (professional, clear)&lt;br&gt;• Flint (mentor, encouraging)&lt;br&gt;• Cinder (playful, casual)&lt;br&gt;• Custom (user-defined)&lt;br&gt;&lt;br&gt;&lt;i&gt;Bundles L1 + L2 settings&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="470" y="110" width="155" height="175" as="geometry" />
        </mxCell>

        <!-- Arrows between layers -->
        <mxCell id="pers-arr-1to2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="pers-identity" target="pers-style">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pers-arr-2to3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="pers-style" target="pers-archetype">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Layer composition note -->
        <mxCell id="pers-layer-note" value="Layers compose hierarchically: Archetype presets combine Identity + Style defaults" style="text;html=1;strokeColor=none;fillColor=none;fontSize=10;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="60" y="310" width="400" height="20" as="geometry" />
        </mxCell>

        <!-- VOICE VS TONE SECTION -->
        <mxCell id="pers-voice-section" value="&lt;b&gt;VOICE vs TONE&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#FCE5CD;strokeColor=#B45F06;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="680" y="70" width="320" height="170" as="geometry" />
        </mxCell>

        <mxCell id="pers-voice" value="&lt;b&gt;Voice (Constants)&lt;/b&gt;&lt;hr&gt;• Core personality traits&lt;br&gt;• Value alignment&lt;br&gt;• Behavioral boundaries&lt;br&gt;&lt;br&gt;&lt;i&gt;Never changes&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="695" y="105" width="135" height="120" as="geometry" />
        </mxCell>

        <mxCell id="pers-tone" value="&lt;b&gt;Tone (Variables)&lt;/b&gt;&lt;hr&gt;• Time of day&lt;br&gt;• Emotional state&lt;br&gt;• Context (work/personal)&lt;br&gt;&lt;br&gt;&lt;i&gt;Adapts dynamically&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="850" y="105" width="135" height="120" as="geometry" />
        </mxCell>

        <!-- PROGRESSIVE DISCLOSURE SECTION -->
        <mxCell id="pers-prog-section" value="&lt;b&gt;PROGRESSIVE DISCLOSURE LAYERS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="40" y="370" width="600" height="300" as="geometry" />
        </mxCell>

        <mxCell id="pers-L0" value="&lt;b&gt;Layer 0: Core Identity&lt;/b&gt;&lt;hr&gt;~100-200 tokens&lt;br&gt;Name, sex, fundamental traits&lt;br&gt;&lt;br&gt;&lt;b&gt;ALWAYS PRESENT&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="410" width="180" height="110" as="geometry" />
        </mxCell>

        <mxCell id="pers-L1" value="&lt;b&gt;Layer 1: Comm Baseline&lt;/b&gt;&lt;hr&gt;~200-400 tokens&lt;br&gt;Tone spectrum values&lt;br&gt;Response patterns&lt;br&gt;&lt;br&gt;&lt;b&gt;ALWAYS PRESENT&lt;/b&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="260" y="410" width="175" height="110" as="geometry" />
        </mxCell>

        <mxCell id="pers-L2" value="&lt;b&gt;Layer 2: Contextual&lt;/b&gt;&lt;hr&gt;Variable tokens&lt;br&gt;Time-of-day modifiers&lt;br&gt;Work vs Personal mode&lt;br&gt;Recent emotional context&lt;br&gt;&lt;br&gt;&lt;i&gt;Injected when relevant&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="455" y="410" width="170" height="130" as="geometry" />
        </mxCell>

        <mxCell id="pers-L3" value="&lt;b&gt;Layer 3: Edge Cases&lt;/b&gt;&lt;hr&gt;Rare injections&lt;br&gt;Specific phrasings to avoid&lt;br&gt;Override behaviors&lt;br&gt;&lt;br&gt;&lt;i&gt;Rarely needed&lt;/i&gt;" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="60" y="545" width="180" height="110" as="geometry" />
        </mxCell>

        <!-- Token budget note -->
        <mxCell id="pers-token-note" value="&lt;b&gt;Token Budgets by Model:&lt;/b&gt; Large Cloud (400-800) | Medium Cloud (200-400) | Local 7B+ (150-300) | Local 3B (100-200)" style="text;html=1;strokeColor=#666666;fillColor=#f5f5f5;fontSize=10;fontColor=#333333;rounded=1;" vertex="1" parent="1">
          <mxGeometry x="260" y="560" width="370" height="40" as="geometry" />
        </mxCell>

        <!-- DYNAMIC INJECTION POINTS -->
        <mxCell id="pers-inject-section" value="&lt;b&gt;DYNAMIC INJECTION POINTS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="680" y="260" width="320" height="200" as="geometry" />
        </mxCell>

        <mxCell id="pers-inj-time" value="&lt;b&gt;TimeService&lt;/b&gt;&lt;hr&gt;Morning energy&lt;br&gt;Evening wind-down&lt;br&gt;Weekend casual&lt;br&gt;Day-of-week patterns" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="695" y="295" width="140" height="100" as="geometry" />
        </mxCell>

        <mxCell id="pers-inj-mem" value="&lt;b&gt;MemoryService&lt;/b&gt;&lt;hr&gt;Relationship history&lt;br&gt;User preferences&lt;br&gt;Past interactions&lt;br&gt;Emotional patterns" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#E1D5E7;strokeColor=#9673a6;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="850" y="295" width="135" height="100" as="geometry" />
        </mxCell>

        <mxCell id="pers-inj-context" value="&lt;b&gt;Context Signals&lt;/b&gt;: Work mode | Personal | Recent emotion | Detected urgency" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="695" y="410" width="300" height="20" as="geometry" />
        </mxCell>

        <!-- SERVICE CONNECTIONS -->
        <mxCell id="pers-svc-section" value="&lt;b&gt;SERVICE CONNECTIONS&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#E8E8E8;strokeColor=#999999;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="680" y="480" width="320" height="190" as="geometry" />
        </mxCell>

        <mxCell id="pers-llm" value="&lt;b&gt;LLMService&lt;/b&gt;&lt;hr&gt;Receives composed&lt;br&gt;system prompt&lt;br&gt;&lt;br&gt;Routes to appropriate&lt;br&gt;model (cloud/local)" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="695" y="515" width="140" height="100" as="geometry" />
        </mxCell>

        <mxCell id="pers-composer" value="&lt;b&gt;PromptComposer&lt;/b&gt;&lt;hr&gt;Assembles layers&lt;br&gt;Injects dynamic context&lt;br&gt;Enforces token budget&lt;br&gt;Model-specific tuning" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;spacingTop=5;fontColor=#333333;" vertex="1" parent="1">
          <mxGeometry x="850" y="515" width="135" height="100" as="geometry" />
        </mxCell>

        <!-- Arrows: Injection to Composer -->
        <mxCell id="pers-arr-time-comp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1" source="pers-inj-time" target="pers-composer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="765" y="450" />
              <mxPoint x="918" y="450" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="pers-arr-mem-comp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#9673a6;strokeWidth=1;endArrow=classic;dashed=1;" edge="1" parent="1" source="pers-inj-mem" target="pers-composer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="918" y="440" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Arrow: Composer to LLM -->
        <mxCell id="pers-arr-comp-llm" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#333333;strokeWidth=2;endArrow=classic;" edge="1" parent="1" source="pers-composer" target="pers-llm">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- Arrow: Layers to Composer -->
        <mxCell id="pers-arr-layers-comp" style="edgeStyle=orthogonalEdgeStyle;rounded=0;html=1;strokeColor=#82b366;strokeWidth=2;endArrow=classic;" edge="1" parent="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="635" y="500" as="sourcePoint" />
            <mxPoint x="850" y="540" as="targetPoint" />
            <Array as="points">
              <mxPoint x="670" y="500" />
              <mxPoint x="670" y="540" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pers-arr-layers-label" value="Static layers" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="640" y="470" width="70" height="15" as="geometry" />
        </mxCell>

        <!-- IMMERSION PRINCIPLES -->
        <mxCell id="pers-immersion" value="&lt;b&gt;IMMERSION PRINCIPLES&lt;/b&gt;&lt;hr&gt;• Avoid LLM-isms (section headers, asterisks, over-hedging)&lt;br&gt;• Natural language patterns that feel human&lt;br&gt;• Earned validation vs reflexive agreement&lt;br&gt;• Consistent voice across model routing&lt;br&gt;• Progressive disclosure prevents context rot" style="text;html=1;strokeColor=#82b366;fillColor=#d5e8d4;fontSize=10;fontColor=#333333;rounded=1;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="40" y="690" width="380" height="110" as="geometry" />
        </mxCell>

        <!-- TRAIT TYPES -->
        <mxCell id="pers-traits" value="&lt;b&gt;TRAIT TYPES&lt;/b&gt;&lt;hr&gt;&lt;b&gt;Static:&lt;/b&gt; Name, sex, core values (never change)&lt;br&gt;&lt;b&gt;Adaptive:&lt;/b&gt; Tone dials adjust to context&lt;br&gt;&lt;b&gt;Emergent:&lt;/b&gt; Patterns from relationship history" style="text;html=1;strokeColor=#6c8ebf;fillColor=#dae8fc;fontSize=10;fontColor=#333333;rounded=1;verticalAlign=top;spacingTop=5;" vertex="1" parent="1">
          <mxGeometry x="450" y="690" width="280" height="90" as="geometry" />
        </mxCell>

        <!-- Research reference -->
        <mxCell id="pers-ref" value="See: docs/research/personality-design.md, conversation-design.md" style="text;html=1;strokeColor=none;fillColor=none;fontSize=9;fontStyle=2;fontColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="40" y="810" width="350" height="15" as="geometry" />
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
